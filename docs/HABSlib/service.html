<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.5.0"/>
    <title>HABSlib API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


            <h2>Contents</h2>
            <ul>
  <li><a href="#habslib-python-library-for-eeg-analysis-and-biomarker-evaluation">HABSlib: Python Library for EEG Analysis and Biomarker Evaluation</a>
  <ul>
    <li><a href="#sessions">Sessions</a></li>
  </ul></li>
</ul>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#validate_metadata">validate_metadata</a>
            </li>
            <li>
                    <a class="function" href="#convert_datetime_in_dict">convert_datetime_in_dict</a>
            </li>
            <li>
                    <a class="function" href="#handshake">handshake</a>
            </li>
            <li>
                    <a class="function" href="#set_user">set_user</a>
            </li>
            <li>
                    <a class="function" href="#search_user_by_mail">search_user_by_mail</a>
            </li>
            <li>
                    <a class="function" href="#get_user_by_id">get_user_by_id</a>
            </li>
            <li>
                    <a class="function" href="#set_session">set_session</a>
            </li>
            <li>
                    <a class="function" href="#get_data_by_id">get_data_by_id</a>
            </li>
            <li>
                    <a class="function" href="#get_data_by_session">get_data_by_session</a>
            </li>
            <li>
                    <a class="function" href="#get_data_ids_by_session">get_data_ids_by_session</a>
            </li>
            <li>
                    <a class="function" href="#upload_data">upload_data</a>
            </li>
            <li>
                    <a class="function" href="#acquire_send_raw">acquire_send_raw</a>
            </li>
            <li>
                    <a class="function" href="#send_file">send_file</a>
            </li>
            <li>
                    <a class="function" href="#set_pipe">set_pipe</a>
            </li>
            <li>
                    <a class="function" href="#upload_pipedata">upload_pipedata</a>
            </li>
            <li>
                    <a class="function" href="#acquire_send_pipe">acquire_send_pipe</a>
            </li>
            <li>
                    <a class="function" href="#train">train</a>
            </li>
            <li>
                    <a class="function" href="#infer">infer</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">

                        <div class="docstring"><h1 id="habslib-python-library-for-eeg-analysis-and-biomarker-evaluation">HABSlib: Python Library for EEG Analysis and Biomarker Evaluation</h1>

<p>HABSlib is a versatile Python library designed to facilitate interaction with the BrainOS HABS API for comprehensive EEG data analysis and biomarker evaluation. 
Developed to support neuroscientific research and clinical applications, HABSlib simplifies the process of fetching, processing, and analyzing EEG data through a user-friendly interface.</p>

<p>Key Features:</p>

<ul>
<li><strong>API Integration</strong>: Connects with the BrainOS HABS API, allowing users to access EEG data and related services effortlessly.</li>
<li><strong>Data Management</strong>: Provides a robust interface for managing EEG datasets, including storage on the HABS servers.</li>
<li><strong>Biomarker Evaluation</strong>: Enables the analysis of EEG biomarkers, essential for diagnosing and monitoring neurological conditions.</li>
<li><strong>Customizable Pipelines</strong>: Users can create custom analysis pipelines tailored to specific research needs, ensuring flexibility and adaptability in various use cases.</li>
</ul>

<h2 id="sessions">Sessions</h2>

<p>The communications between the user and HABS BrainOS is based on a RESTful API (see doc) and structured into sessions.    </p>

<p>A <em>Session</em> with the HABS BrainOS iinitiates with an handshake during which encryption keys are exchanged for the security of any following communication between the user and the server.</p>

<h3 id="simple-sessions">Simple sessions</h3>

<p>There are two general types of session: <em>real-time</em> and <em>off-line</em>.</p>

<p>In setting a either a real-time or off-line session, the user provides the session metadata, such as their user_id, session_date (both required), and additional notes depending on the nature of recordings.</p>

<p>Then, in a real-time session, the user specifies the type of EEG DEVICE ('board') used, the duration of the EEG recording, and the frequency of server update. </p>

<p>In an off-line session, the user specifies a file name from which the data should be read. The HABSlib reads the file (it currently supports EDF file type only, but it's growing) and sends it to the server.</p>

<p>In these simple types of session, after the real-time or offline uploading, the data can be selected via the session_id for further processing.</p>

<h3 id="piped-sessions">Piped sessions</h3>

<p>There is another type of session, called <em>piped</em> session, during which the EEG data is processed by the server as soon as it is received, and the results are sent back to the user as soon as they are processed. <br />
This type of session is real-time only. During its setup, users can choose (from a growing number of available functions) the type of processing they wish to be performed on the data.</p>
</div>

                        <input id="mod-service-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-service-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1">######################################################</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># INTRO</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="sd"># HABSlib: Python Library for EEG Analysis and Biomarker Evaluation</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="sd">HABSlib is a versatile Python library designed to facilitate interaction with the BrainOS HABS API for comprehensive EEG data analysis and biomarker evaluation. </span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="sd">Developed to support neuroscientific research and clinical applications, HABSlib simplifies the process of fetching, processing, and analyzing EEG data through a user-friendly interface.</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="sd">Key Features:</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="sd">- **API Integration**: Connects with the BrainOS HABS API, allowing users to access EEG data and related services effortlessly.</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="sd">- **Data Management**: Provides a robust interface for managing EEG datasets, including storage on the HABS servers.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="sd">- **Biomarker Evaluation**: Enables the analysis of EEG biomarkers, essential for diagnosing and monitoring neurological conditions.</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="sd">- **Customizable Pipelines**: Users can create custom analysis pipelines tailored to specific research needs, ensuring flexibility and adaptability in various use cases.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="sd">## Sessions</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">The communications between the user and HABS BrainOS is based on a RESTful API (see doc) and structured into sessions.    </span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">A *Session* with the HABS BrainOS iinitiates with an handshake during which encryption keys are exchanged for the security of any following communication between the user and the server.</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">### Simple sessions</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a><span class="sd">There are two general types of session: *real-time* and *off-line*.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="sd">In setting a either a real-time or off-line session, the user provides the session metadata, such as their user_id, session_date (both required), and additional notes depending on the nature of recordings.</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="sd">Then, in a real-time session, the user specifies the type of EEG DEVICE (&#39;board&#39;) used, the duration of the EEG recording, and the frequency of server update. </span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="sd">In an off-line session, the user specifies a file name from which the data should be read. The HABSlib reads the file (it currently supports EDF file type only, but it&#39;s growing) and sends it to the server.</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a><span class="sd">In these simple types of session, after the real-time or offline uploading, the data can be selected via the session_id for further processing.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="sd">### Piped sessions</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a><span class="sd">There is another type of session, called *piped* session, during which the EEG data is processed by the server as soon as it is received, and the results are sent back to the user as soon as they are processed.    </span>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a><span class="sd">This type of session is real-time only. During its setup, users can choose (from a growing number of available functions) the type of processing they wish to be performed on the data.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a><span class="kn">import</span> <span class="nn">sys</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a><span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a><span class="kn">import</span> <span class="nn">base64</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="kn">import</span> <span class="nn">requests</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a><span class="kn">import</span> <span class="nn">json</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a><span class="kn">import</span> <span class="nn">jsonschema</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a><span class="kn">from</span> <span class="nn">jsonschema</span> <span class="kn">import</span> <span class="n">validate</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a><span class="kn">from</span> <span class="nn">jsonschema</span> <span class="kn">import</span> <span class="n">exceptions</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a><span class="c1"># from bson import json_util</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="kn">import</span> <span class="nn">time</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a><span class="kn">import</span> <span class="nn">uuid</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a><span class="kn">import</span> <span class="nn">asyncio</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BASE_URL</span><span class="p">,</span> <span class="n">VERSION</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">BoardManager</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a><span class="kn">from</span> <span class="nn">cryptography.hazmat.primitives</span> <span class="kn">import</span> <span class="n">hashes</span><span class="p">,</span> <span class="n">serialization</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a><span class="kn">from</span> <span class="nn">cryptography.hazmat.backends</span> <span class="kn">import</span> <span class="n">default_backend</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">store_public_key</span><span class="p">,</span> <span class="n">load_public_key</span><span class="p">,</span> <span class="n">generate_aes_key</span><span class="p">,</span> <span class="n">encrypt_aes_key_with_rsa</span><span class="p">,</span> <span class="n">encrypt_message</span><span class="p">,</span> <span class="n">decrypt_message</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a><span class="kn">from</span> <span class="nn">pyedflib</span> <span class="kn">import</span> <span class="n">highlevel</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a><span class="c1">######################################################</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a><span class="c1"># validate the metadata against a specified schema</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a><span class="k">def</span> <span class="nf">validate_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">,</span> <span class="n">schemafile</span><span class="o">=</span><span class="s1">&#39;metadata.json&#39;</span><span class="p">):</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a><span class="sd">    Validate metadata against a given JSON schema.</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a><span class="sd">    Args:    </span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a><span class="sd">        **metadata** (*dict*): The metadata to be validated.    </span>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a><span class="sd">        **schema_name** (*str*): The name of the schema to validate against. HABSlib currently supports the validation of Session metadata and User data.    </span>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="sd">        **schemafile** (*str*, optional): The path to the JSON file containing the schemas. Defaults to &#39;metadata.json&#39;.    </span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a><span class="sd">    Returns:    </span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a><span class="sd">        *bool*: True if validation is successful, False otherwise.</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a><span class="sd">    Raises:    </span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a><span class="sd">        **FileNotFoundError**: If the schema file does not exist.     </span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="sd">        **json.JSONDecodeError**: If there is an error decoding the JSON schema file.     </span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="sd">        **exceptions.ValidationError**: If the metadata does not conform to the schema.     </span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a><span class="sd">        **Exception**: For any other errors that occur during validation.     </span>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">    Example:</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">    ```</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">    metadata = {&quot;name&quot;: &quot;example&quot;, &quot;type&quot;: &quot;data&quot;}</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">    schema_name = &quot;example_schema&quot;</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">    is_valid = validate_metadata(metadata, schema_name)</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">    if is_valid:</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        print(&quot;Metadata is valid.&quot;)</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">    else:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">        print(&quot;Metadata is invalid.&quot;)</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">    ```</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">schemafile</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a>            <span class="n">schemas</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>        <span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span> <span class="c1">#, format_checker=FormatChecker())</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Metadata validation successful!&quot;</span><span class="p">)</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to decode JSON:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No such file: </span><span class="si">{</span><span class="n">schemafile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A general error occurred:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a><span class="k">def</span> <span class="nf">convert_datetime_in_dict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a><span class="sd">    Recursively converts all datetime objects in a dictionary to strings in ISO format.</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a><span class="sd">    Args:     </span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a><span class="sd">        **data** (*dict*): The dictionary containing the data.</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a><span class="sd">    Returns:     </span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a><span class="sd">        *dict*: The dictionary with datetime objects converted to strings.</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">return</span> <span class="n">data</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a><span class="c1">######################################################</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a><span class="k">def</span> <span class="nf">handshake</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>  
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a><span class="sd">    Perform a handshake with the server to exchange encryption keys for the current session.</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a><span class="sd">    This function performs the following steps:</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a><span class="sd">    0. Performs login to the HABS server.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a><span class="sd">    1. Sends a GET request to the server to initiate an RSA handshake.</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a><span class="sd">    2. Retrieves the server&#39;s public RSA key from the response.</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a><span class="sd">    3. Generates a local AES key and stores it in the environment.</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a><span class="sd">    4. Encrypts the AES key with the server&#39;s RSA key.</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a><span class="sd">    5. Sends the encrypted AES key to the server to complete the AES handshake.</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a><span class="sd">    Args:      </span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a><span class="sd">        **base_url** (*str*): The base URL of the server&#39;s API.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a><span class="sd">    Returns:     </span>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a><span class="sd">        *bool*: True if the handshake is successful, None otherwise.</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a><span class="sd">    Raises:      </span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a><span class="sd">        **requests.RequestException**: If a request to the server fails.</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a><span class="sd">    Example:</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a><span class="sd">    ```</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a><span class="sd">    success = handshake(&quot;https://example.com&quot;)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a><span class="sd">    if success:</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a><span class="sd">        print(&quot;Handshake completed successfully.&quot;)</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a><span class="sd">    else:</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a><span class="sd">        print(&quot;Handshake failed.&quot;)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="sd">    ```</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="k">global</span> <span class="n">BASE_URL</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="n">base_url</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/handshake_rsa&quot;</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (RSA) successful.&quot;</span><span class="p">)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>        <span class="n">api_public_key_pem</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_public_key&#39;</span><span class="p">)</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="n">api_public_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_public_key</span><span class="p">(</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>            <span class="n">api_public_key_pem</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>            <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">()</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>        <span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;API_PUBLIC_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_public_key_pem</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>        <span class="c1"># Then we generate and store the AES key</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>        <span class="n">aes_key</span> <span class="o">=</span> <span class="n">generate_aes_key</span><span class="p">()</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>        <span class="c1"># print(&quot;aes_key&quot;, aes_key)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span> <span class="n">aes_key</span> <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>        <span class="n">encrypted_aes_key</span> <span class="o">=</span> <span class="n">encrypt_aes_key_with_rsa</span><span class="p">(</span><span class="n">aes_key</span><span class="p">,</span> <span class="n">api_public_key</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>        <span class="n">encrypted_aes_key_b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted_aes_key</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>        <span class="c1"># print(&quot;encrypted_aes_key_b64&quot;,encrypted_aes_key_b64)</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>        <span class="n">aes_key_payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>            <span class="s2">&quot;encrypted_aes_key&quot;</span><span class="p">:</span> <span class="n">encrypted_aes_key_b64</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="p">}</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/handshake_aes&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">aes_key_payload</span><span class="p">)</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (AES) successful.&quot;</span><span class="p">)</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (AES) failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (RSA) failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a><span class="c1">######################################################</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a><span class="k">def</span> <span class="nf">set_user</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a><span class="sd">    Creates a user by sending user data to the server.</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a><span class="sd">    This function performs the following steps:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a><span class="sd">    1. Constructs the user data dictionary.</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a><span class="sd">    2. Validates the user data against the &quot;userSchema&quot;.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a><span class="sd">    3. Encrypts the user data using the stored AES key.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a><span class="sd">    4. Sends the encrypted user data to the server.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a><span class="sd">    5. Handles the server&#39;s response.</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a><span class="sd">    Args:     </span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a><span class="sd">    **first_name** (*str*, optional): The user&#39;s first name.      </span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a><span class="sd">    **last_name** (*str*, optional): The user&#39;s last name.     </span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a><span class="sd">    **email** (*str*, optional): The user&#39;s email address.     </span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a><span class="sd">    **age** (*int*, optional): The user&#39;s age.     </span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a><span class="sd">    **weight** (*float*, optional): The user&#39;s weight.     </span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a><span class="sd">    **gender** (*str*, optional): The user&#39;s gender.      </span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a><span class="sd">    Returns:       </span>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a><span class="sd">        *str*: The user ID if the user is successfully created/retrieved, None otherwise.</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a><span class="sd">    Example:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a><span class="sd">    ```</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a><span class="sd">    user_id = set_user(first_name=&quot;John&quot;, last_name=&quot;Doe&quot;, email=&quot;john.doe@example.com&quot;, age=30, weight=70.5, gender=&quot;X&quot;)</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a><span class="sd">    if user_id:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a><span class="sd">        print(f&quot;User created/retrieved with ID: {user_id}&quot;)</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a><span class="sd">    else:</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a><span class="sd">        print(&quot;User creation failed.&quot;)</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a><span class="sd">    ```</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>    <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>        <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span> 
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>        <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span> 
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> 
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">age</span><span class="p">,</span> 
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> 
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>        <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="n">gender</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>    <span class="p">}</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>    <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="s2">&quot;userSchema&quot;</span><span class="p">,</span> <span class="p">):</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>        <span class="n">_user</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>            <span class="s2">&quot;user_data&quot;</span><span class="p">:</span> <span class="n">user_data</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>        <span class="p">}</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>        <span class="n">_user</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_user</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>            <span class="n">url</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_user</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>        <span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User successfully created/retrieved.&quot;</span><span class="p">)</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>            <span class="k">return</span> <span class="n">user_id</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User creation failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User creation failed.&quot;</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a><span class="c1">######################################################</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a><span class="k">def</span> <span class="nf">search_user_by_mail</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a><span class="sd">    Search for a user by email.</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a><span class="sd">    This function sends a GET request to the server to search for a user by the provided email address.</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a><span class="sd">    Args:     </span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a><span class="sd">        **email** (*str*): The email address of the user to search for.</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a><span class="sd">    Returns:     </span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a><span class="sd">        *str*: The user ID if the user is found, None otherwise.</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="sd">    Example:</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a><span class="sd">    ```</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    user_id = search_user_by_mail(&quot;john.doe@example.com&quot;)</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    if user_id:</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">        print(f&quot;User found with ID: {user_id}&quot;)</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a><span class="sd">    else:</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">        print(&quot;User not found.&quot;)</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    ```</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users?email=</span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a>        <span class="n">user_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User found:&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a>        <span class="k">return</span> <span class="n">user_id</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found.&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="c1">######################################################</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="k">def</span> <span class="nf">get_user_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">    Retrieve user data by user ID.</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">    This function sends a GET request to the server to retrieve user data for the specified user ID.     </span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">    The response data is decrypted using AES before returning the user data.</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">    Args:     </span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        **user_id** (*str*): The unique identifier of the user to retrieve.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">    Returns:     </span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        *dict*: The user data if the user is found, None otherwise.</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">    Example:</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">    ```</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a><span class="sd">    user_data = get_user_by_id(&quot;1234567890&quot;)</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    if user_data:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        print(f&quot;User data: {user_data}&quot;)</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">    else:</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">        print(&quot;User not found.&quot;)</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a><span class="sd">    ```</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User found.&quot;</span><span class="p">)</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>        <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> 
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>        <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>        <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>        <span class="n">decrypted_json_string</span> <span class="o">=</span> <span class="n">decrypt_message</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">)</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>        <span class="n">user_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decrypted_json_string</span><span class="p">)[</span><span class="s1">&#39;user_data&#39;</span><span class="p">]</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>        <span class="k">return</span> <span class="n">user_data</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a><span class="c1">######################################################</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a><span class="k">def</span> <span class="nf">set_session</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a><span class="sd">    Create a new simple session.</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a><span class="sd">    This function sends a POST request to the server to create a new simple session using the provided metadata.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a><span class="sd">    The metadata is encrypted using AES before being sent to the server.</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a><span class="sd">    Args:     </span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a><span class="sd">        **metadata** (*dict*): A dictionary containing the session metadata. The only required metadata for the simple session are the user_id and a date.</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a><span class="sd">    Returns:      </span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a><span class="sd">        *str*: The unique identifier of the created session if successful, None otherwise.</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a><span class="sd">    Example:</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a><span class="sd">    ```</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a><span class="sd">    session_metadata = {</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a><span class="sd">        &quot;user_id&quot;: &quot;1076203852085&quot;,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a><span class="sd">        &quot;session_date&quot;: &quot;2024-05-30T12:00:00Z&quot;</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a><span class="sd">    }</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a><span class="sd">    session_id = set_session(session_metadata)</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a><span class="sd">    if session_id:</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a><span class="sd">        print(f&quot;Session created with ID: {session_id}&quot;)</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a><span class="sd">    else:</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a><span class="sd">        print(&quot;Failed to create session.&quot;)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a><span class="sd">    ```</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions&quot;</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_session</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_session</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>    <span class="p">)</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session successfully created.&quot;</span><span class="p">)</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="c1"># print(session_id)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a><span class="c1">######################################################</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a><span class="k">def</span> <span class="nf">get_data_by_id</span><span class="p">(</span><span class="n">data_id</span><span class="p">):</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a><span class="sd">    Retrieve raw data by its unique identifier from the server.</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a><span class="sd">    This function sends a GET request to fetch raw data associated with a specific identifier. It</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a><span class="sd">    assumes that the data, if retrieved successfully, does not require decryption and is directly accessible.</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a><span class="sd">    Args:      </span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a><span class="sd">        **data_id** (*str*): The unique identifier for the data to be retrieved.</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a><span class="sd">    Returns:       </span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a><span class="sd">        **dict**: The raw data if retrieval is successful, None otherwise.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a><span class="sd">    Example:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a><span class="sd">    ```</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a><span class="sd">    data_id = &quot;1234&quot;</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a><span class="sd">    raw_data = get_data_by_id(data_id)</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a><span class="sd">    ... use the data</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a><span class="sd">    ```</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/rawdata/</span><span class="si">{</span><span class="n">data_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>    
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>    
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved data successfully.&quot;</span><span class="p">)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>        <span class="c1"># decrypt</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rawData&#39;</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve data:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a><span class="c1">######################################################</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a><span class="k">def</span> <span class="nf">get_data_by_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">):</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a><span class="sd">    Retrieve raw data associated with a specific session identifier from the server.</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a><span class="sd">    This function sends a GET request to fetch all raw data linked to the given session ID. The data</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a><span class="sd">    is returned in its raw form assuming it does not require decryption for usage.</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a><span class="sd">    Args:      </span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a><span class="sd">        **session_id** (*str*): The session identifier whose associated data is to be retrieved.</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a><span class="sd">    Returns:       </span>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a><span class="sd">        *dict*: The raw data linked to the session if retrieval is successful, None otherwise.</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a><span class="sd">    Example:</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a><span class="sd">    ```</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a><span class="sd">    session_id = &quot;abcd1234&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a><span class="sd">    session_data = get_data_by_session(session_id)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a><span class="sd">    if session_data:</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a><span class="sd">        print(&quot;Data retrieved:&quot;, session_data)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a><span class="sd">    else:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a><span class="sd">        print(&quot;Failed to retrieve data.&quot;)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a><span class="sd">    ```</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">/rawdata&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>    
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>    
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved data successfully.&quot;</span><span class="p">)</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="c1"># decrypt</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve data:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a><span class="c1">######################################################</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a><span class="k">def</span> <span class="nf">get_data_ids_by_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">):</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="sd">    Retrieve a list of data IDs associated with a specific session from the server.</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a><span class="sd">    This function sends a GET request to fetch the IDs of all data entries linked to a specified session ID.</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a><span class="sd">    The IDs are returned as a list. The function assumes the data does not require decryption for usage.</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a><span class="sd">    Args:      </span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a><span class="sd">        **session_id** (*str*): The session identifier for which data IDs are to be retrieved.</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a><span class="sd">    Returns:       </span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a><span class="sd">        *list*: A list of data IDs if retrieval is successful, None otherwise.</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a><span class="sd">    Example:</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a><span class="sd">    ```</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a><span class="sd">    session_id = &quot;abcd1234&quot;</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a><span class="sd">    data_ids = get_data_ids_by_session(session_id)</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a><span class="sd">    if data_ids:</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a><span class="sd">        print(&quot;Data IDs retrieved:&quot;, data_ids)</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="sd">    else:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="sd">        print(&quot;Failed to retrieve data IDs.&quot;)</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a><span class="sd">    ```</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">/ids&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a>    
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>    
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved ids successfully.&quot;</span><span class="p">)</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a>        <span class="c1"># decrypt</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ids&#39;</span><span class="p">)</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve ids:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="c1">######################################################</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="k">def</span> <span class="nf">upload_data</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ppg_red</span><span class="p">,</span> <span class="n">ppg_ir</span><span class="p">):</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">    Uploads EEG and PPG data to the server along with associated metadata.</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">    This function compiles different types of physiological data along with metadata into a single dictionary,</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">    encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">    unique identifier for the data which can then be used for future queries or operations.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">    Args:     </span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">    **metadata** (*dict*): Information about the data such as subject details and session parameters.     </span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">    **timestamps** (*list*): List of timestamps correlating with each data point.     </span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">    **data** (*list*): EEG data points.     </span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">    **ppg_red** (*list*): Red photoplethysmogram data points.     </span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">    **ppg_ir** (*list*): Infrared photoplethysmogram data points.      </span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">    Returns:     </span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">    *tuple*: A tuple containing the data ID of the uploaded data if successful, and None otherwise.</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">    Example:</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">    ```</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">    metadata = {&quot;session_id&quot;: &quot;1234&quot;, &quot;subject_id&quot;: &quot;001&quot;}</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">    timestamps = [1597709184, 1597709185]</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a><span class="sd">    data = [0.1, 0.2]</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">    ppg_red = [123, 124]</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">    ppg_ir = [125, 126]</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">    data_id, error = upload_data(metadata, timestamps, data, ppg_red, ppg_ir)</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a><span class="sd">    if data_id:</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a><span class="sd">        print(&quot;Data uploaded successfully. Data ID:&quot;, data_id)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a><span class="sd">    else:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a><span class="sd">        print(&quot;Upload failed with error:&quot;, error)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a><span class="sd">    ```</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/rawdata&quot;</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>        <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="s2">&quot;ppg_red&quot;</span><span class="p">:</span> <span class="n">ppg_red</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="s2">&quot;ppg_ir&quot;</span><span class="p">:</span> <span class="n">ppg_ir</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>    <span class="p">}</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>    <span class="c1"># response = requests.post(url, json=_data)</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>    <span class="p">)</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>        <span class="n">data_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_id&#39;</span><span class="p">)</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>        <span class="k">return</span> <span class="n">data_id</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upload failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a><span class="c1">######################################################</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a><span class="k">def</span> <span class="nf">acquire_send_raw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">):</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a><span class="sd">    Asynchronously acquires raw data from a specific EEG board and sends it to the server.</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a><span class="sd">    This function connects to an EEG board, initiates a data acquisition session, and sends the collected data</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a><span class="sd">    to the server in real-time or near real-time. It ensures that all the data handled during the session</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a><span class="sd">    is associated with a unique session ID and metadata that includes user and session details. The function</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a><span class="sd">    will validate the session metadata before proceeding with data acquisition and sending.</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a><span class="sd">    Args:      </span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="sd">    **user_id** (*str*): The unique identifier of the user for whom the data is being collected.      </span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="sd">    **date** (*str*): The date of the session, used for metadata purposes.     </span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a><span class="sd">    **board** (*int*): Identifier for the EEG board from which data will be acquired.      </span>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">    **stream_duration** (*int*): Duration in seconds for which data will be streamed from the board.     </span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">    **buffer_duration** (*int*): Time in seconds for how often the data is buffered and sent.     </span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">    Returns:     </span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a><span class="sd">    *str* or *bool*: The session ID if the operation is successful; False otherwise.</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">    Raises:</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">    **ConnectionError**: If the board connection fails.      </span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">    **ValidationError**: If the metadata does not comply with the required schema.</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">    Example:</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">    ```</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">    session = acquire_send_raw(&#39;user123&#39;, &#39;2021-06-01&#39;, &#39;MUSE_S&#39;, 300, 10)</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">    if session:</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">        print(f&quot;Session successfully started with ID: {session}&quot;)</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">    else:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">        print(&quot;Failed to start session&quot;)</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">    ```</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> <span class="n">_acquire_send_raw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">)</span> <span class="p">)</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a>    <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="k">async</span> <span class="k">def</span> <span class="nf">_acquire_send_raw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">):</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a>    <span class="c1"># get board</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a>    <span class="n">board_manager</span> <span class="o">=</span> <span class="n">BoardManager</span><span class="p">(</span><span class="n">enable_logger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">board_id</span><span class="o">=</span><span class="n">board</span><span class="p">)</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a>    <span class="n">board_manager</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a>    <span class="c1"># set session for the data</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a>    <span class="c1"># We set a session id for the current interaction with the API (even if we fail to get the board, it will be important to store the failure)</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a>    <span class="n">session_metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a>      <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="c1"># add user to the session for reference</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>      <span class="s2">&quot;session_date&quot;</span><span class="p">:</span> <span class="n">date</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a>    <span class="p">}</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a>    <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">session_metadata</span><span class="p">,</span> <span class="s2">&quot;sessionSchema&quot;</span><span class="p">):</span>        
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">set_session</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">session_metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">board_manager</span><span class="o">.</span><span class="n">metadata</span><span class="p">})</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>        <span class="n">board_manager</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span> <span class="c1"># add session to the data for reference</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>        <span class="c1"># stream_duration sec, buffer_duration sec</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="k">await</span> <span class="n">board_manager</span><span class="o">.</span><span class="n">data_acquisition_loop</span><span class="p">(</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>            <span class="n">stream_duration</span><span class="o">=</span><span class="n">stream_duration</span><span class="p">,</span> 
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>            <span class="n">buffer_duration</span><span class="o">=</span><span class="n">buffer_duration</span><span class="p">,</span> 
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>            <span class="n">service</span><span class="o">=</span><span class="n">upload_data</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="p">)</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a><span class="c1">######################################################</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a><span class="k">def</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">edf_file</span><span class="p">,</span> <span class="n">ch_nrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ch_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a><span class="sd">    Uploads EEG data from a file to the server along with associated metadata.</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a><span class="sd">    This function compiles EEG data from an [EDF file](https://www.edfplus.info/downloads/index.html) along with metadata into a single dictionary,</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a><span class="sd">    encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a><span class="sd">    unique identifier for the session which can then be used for future queries or operations.</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos">645</span></a><span class="sd">    Args:    </span>
</span><span id="L-646"><a href="#L-646"><span class="linenos">646</span></a><span class="sd">    **user_id** (*str*): The unique identifier of the user for whom the data is being collected.     </span>
</span><span id="L-647"><a href="#L-647"><span class="linenos">647</span></a><span class="sd">    **metadata** (*dict*): Information about the data such as subject details and session parameters.     </span>
</span><span id="L-648"><a href="#L-648"><span class="linenos">648</span></a><span class="sd">    **date** (*str*): The date of the session, used for metadata purposes.     </span>
</span><span id="L-649"><a href="#L-649"><span class="linenos">649</span></a><span class="sd">    **edf_file** (*str*): name of an EDF file.      </span>
</span><span id="L-650"><a href="#L-650"><span class="linenos">650</span></a><span class="sd">    **ch_nrs** (*list of int*, optional): The indices of the channels to read. The default is None.     </span>
</span><span id="L-651"><a href="#L-651"><span class="linenos">651</span></a><span class="sd">    **ch_names** (*list of str*, optional): The names of channels to read. The default is None.     </span>
</span><span id="L-652"><a href="#L-652"><span class="linenos">652</span></a>
</span><span id="L-653"><a href="#L-653"><span class="linenos">653</span></a><span class="sd">    Returns:     </span>
</span><span id="L-654"><a href="#L-654"><span class="linenos">654</span></a><span class="sd">        *tuple*: A tuple containing the session ID of the uploaded data if successful, and None otherwise.</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos">655</span></a>
</span><span id="L-656"><a href="#L-656"><span class="linenos">656</span></a><span class="sd">    Example:</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos">657</span></a><span class="sd">    ```</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos">658</span></a><span class="sd">    session = send_file(&#39;user123&#39;, &#39;2021-06-01&#39;, &#39;nameoffile.edf&#39;)</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos">659</span></a><span class="sd">    if session:</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos">660</span></a><span class="sd">        print(f&quot;Session successfully started with ID: {session}&quot;)</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos">661</span></a><span class="sd">    else:</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos">662</span></a><span class="sd">        print(&quot;Failed to start session&quot;)</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos">663</span></a><span class="sd">    ```</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos">664</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos">665</span></a>
</span><span id="L-666"><a href="#L-666"><span class="linenos">666</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos">667</span></a>        <span class="n">signals</span><span class="p">,</span> <span class="n">signal_headers</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">highlevel</span><span class="o">.</span><span class="n">read_edf</span><span class="p">(</span><span class="n">edf_file</span><span class="p">,</span> <span class="n">ch_nrs</span><span class="p">,</span> <span class="n">ch_names</span><span class="p">)</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos">668</span></a>
</span><span id="L-669"><a href="#L-669"><span class="linenos">669</span></a>        <span class="n">max_time</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">signal_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sample_frequency&#39;</span><span class="p">]</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos">670</span></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">(),</span> <span class="n">max_time</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos">671</span></a>
</span><span id="L-672"><a href="#L-672"><span class="linenos">672</span></a>        <span class="n">session_metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos">673</span></a>          <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="c1"># add user to the session for reference</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos">674</span></a>          <span class="s2">&quot;session_date&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos">675</span></a>        <span class="p">}</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos">676</span></a>        <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">session_metadata</span><span class="p">,</span> <span class="s2">&quot;sessionSchema&quot;</span><span class="p">):</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos">677</span></a>            <span class="n">session_id</span> <span class="o">=</span> <span class="n">set_session</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">session_metadata</span><span class="p">})</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos">678</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span><span class="n">session_id</span><span class="p">,</span> <span class="o">**</span><span class="n">session_metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="o">**</span><span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">signal_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos">679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos">680</span></a>            <span class="n">chunks</span> <span class="o">=</span> <span class="p">((</span><span class="n">signals</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">signals</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span><span class="o">//</span><span class="mi">300000</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos">681</span></a>            <span class="n">timestamps_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos">682</span></a>            <span class="n">signals_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos">683</span></a>            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">signals_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos">684</span></a>            <span class="n">size_in_bytes</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos">685</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> total bytes will be sent into </span><span class="si">%d</span><span class="s2"> chunks of </span><span class="si">%d</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">signals</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">size_in_bytes</span><span class="p">))</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos">686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos">687</span></a>            <span class="k">for</span> <span class="n">timestamps_chunk</span><span class="p">,</span><span class="n">signals_chunk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">timestamps_chunks</span><span class="p">,</span> <span class="n">signals_chunks</span><span class="p">):</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos">688</span></a>                <span class="n">upload_data</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps_chunk</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">signals_chunk</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[],</span> <span class="p">[])</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos">689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos">690</span></a>            <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos">691</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos">692</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos">693</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos">694</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A general error occurred:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos">695</span></a>        <span class="k">return</span> <span class="kc">False</span>    
</span><span id="L-696"><a href="#L-696"><span class="linenos">696</span></a>
</span><span id="L-697"><a href="#L-697"><span class="linenos">697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos">698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos">699</span></a><span class="c1">######################################################</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos">700</span></a><span class="c1">######################################################</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos">701</span></a><span class="k">def</span> <span class="nf">set_pipe</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos">702</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos">703</span></a><span class="sd">    Configures and initiates a data processing pipeline for a session on the server.</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos">704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos">705</span></a><span class="sd">    This function sends metadata and processing parameters to a specified pipeline endpoint</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos">706</span></a><span class="sd">    to create a data processing session. It encrypts the session data before sending to ensure</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos">707</span></a><span class="sd">    security. The function checks the server response to confirm the session creation.</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos">708</span></a>
</span><span id="L-709"><a href="#L-709"><span class="linenos">709</span></a><span class="sd">    Args:     </span>
</span><span id="L-710"><a href="#L-710"><span class="linenos">710</span></a><span class="sd">    **metadata** (*dict*): A dictionary containing metadata about the session, typically including</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos">711</span></a><span class="sd">                     details such as user ID and session date.       </span>
</span><span id="L-712"><a href="#L-712"><span class="linenos">712</span></a><span class="sd">    **pipeline** (*str*): The identifier for the processing pipeline to be used.      </span>
</span><span id="L-713"><a href="#L-713"><span class="linenos">713</span></a><span class="sd">    **params** (*dict*): Parameters specific to the processing pipeline, detailing how data should</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos">714</span></a><span class="sd">                   be processed.      </span>
</span><span id="L-715"><a href="#L-715"><span class="linenos">715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos">716</span></a><span class="sd">    Returns:       </span>
</span><span id="L-717"><a href="#L-717"><span class="linenos">717</span></a><span class="sd">        *str* or *None*: The session ID if the session is successfully created, or None if the operation fails.</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos">718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos">719</span></a><span class="sd">    Raises:     </span>
</span><span id="L-720"><a href="#L-720"><span class="linenos">720</span></a><span class="sd">        **requests.exceptions.RequestException**: An error from the Requests library when an HTTP request fails.      </span>
</span><span id="L-721"><a href="#L-721"><span class="linenos">721</span></a><span class="sd">        **KeyError**: If necessary keys are missing in the environment variables.</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos">722</span></a>
</span><span id="L-723"><a href="#L-723"><span class="linenos">723</span></a><span class="sd">    Example:</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos">724</span></a><span class="sd">    ```</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos">725</span></a><span class="sd">    session_metadata = {&quot;user_id&quot;: &quot;123&quot;, &quot;session_date&quot;: &quot;2024-06-03&quot;}</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos">726</span></a><span class="sd">    processing_params = {&quot;filter_type&quot;: &quot;lowpass&quot;, &quot;cutoff_freq&quot;: 30}</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos">727</span></a><span class="sd">    session_id = set_pipe(session_metadata, &#39;eeg_smoothing&#39;, processing_params)</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos">728</span></a><span class="sd">    if session_id:</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos">729</span></a><span class="sd">        print(f&quot;Pipeline session created with ID: {session_id}&quot;)</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos">730</span></a><span class="sd">    else:</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos">731</span></a><span class="sd">        print(&quot;Failed to create pipeline session&quot;)</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos">732</span></a><span class="sd">    ```</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos">733</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos">734</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/pipe/</span><span class="si">{</span><span class="n">pipeline</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos">735</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos">736</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos">737</span></a>        <span class="s2">&quot;processing_params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos">738</span></a>    <span class="p">}</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos">739</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_session</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos">740</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos">741</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos">742</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos">743</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos">744</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_session</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos">745</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos">746</span></a>    <span class="p">)</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos">747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos">748</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos">749</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session successfully created.&quot;</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos">750</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos">751</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos">752</span></a>        <span class="c1"># print(session_id)</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos">753</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos">754</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos">755</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos">756</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos">757</span></a>
</span><span id="L-758"><a href="#L-758"><span class="linenos">758</span></a>
</span><span id="L-759"><a href="#L-759"><span class="linenos">759</span></a><span class="c1">######################################################</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos">760</span></a><span class="k">def</span> <span class="nf">upload_pipedata</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ppg_red</span><span class="p">,</span> <span class="n">ppg_ir</span><span class="p">):</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos">761</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos">762</span></a><span class="sd">    Uploads processed data to a specific session on the server.</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos">763</span></a>
</span><span id="L-764"><a href="#L-764"><span class="linenos">764</span></a><span class="sd">    This function is responsible for uploading various data streams associated with a session, including</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos">765</span></a><span class="sd">    timestamps and physiological measurements such as PPG (Photoplethysmogram). The data is encrypted before</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos">766</span></a><span class="sd">    sending to ensure confidentiality and integrity.</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos">767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos">768</span></a><span class="sd">    Args:        </span>
</span><span id="L-769"><a href="#L-769"><span class="linenos">769</span></a><span class="sd">    **metadata** (*dict*): Contains session-related metadata including the session ID.      </span>
</span><span id="L-770"><a href="#L-770"><span class="linenos">770</span></a><span class="sd">    **timestamps** (*list*): A list of timestamps corresponding to each data point.      </span>
</span><span id="L-771"><a href="#L-771"><span class="linenos">771</span></a><span class="sd">    **data** (*list*): The main data collected, e.g., EEG readings.      </span>
</span><span id="L-772"><a href="#L-772"><span class="linenos">772</span></a><span class="sd">    **ppg_red** (*list*): Red channel data from a PPG sensor.    </span>
</span><span id="L-773"><a href="#L-773"><span class="linenos">773</span></a><span class="sd">    **ppg_ir** (*list*): Infrared channel data from a PPG sensor.     </span>
</span><span id="L-774"><a href="#L-774"><span class="linenos">774</span></a>
</span><span id="L-775"><a href="#L-775"><span class="linenos">775</span></a><span class="sd">    Returns:     </span>
</span><span id="L-776"><a href="#L-776"><span class="linenos">776</span></a><span class="sd">    *tuple*: A tuple containing the data ID if the upload is successful and the processed data, or None if the upload fails.</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos">777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos">778</span></a><span class="sd">    Raises:     </span>
</span><span id="L-779"><a href="#L-779"><span class="linenos">779</span></a><span class="sd">    **requests.exceptions.RequestException: An error from the Requests library when an HTTP request fails.</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos">780</span></a><span class="sd">    **KeyError**: If necessary keys are missing in the environment variables.</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos">781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos">782</span></a><span class="sd">    Example:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos">783</span></a><span class="sd">    ```</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos">784</span></a><span class="sd">    session_metadata = {&quot;session_id&quot;: &quot;12345&quot;}</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos">785</span></a><span class="sd">    timestamps = [1597709165, 1597709166, ...]</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos">786</span></a><span class="sd">    data = [0.1, 0.2, ...]</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos">787</span></a><span class="sd">    ppg_red = [12, 15, ...]</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos">788</span></a><span class="sd">    ppg_ir = [20, 22, ...]</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos">789</span></a><span class="sd">    data_id, processed_data = upload_pipedata(session_metadata, timestamps, data, ppg_red, ppg_ir)</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos">790</span></a><span class="sd">    if data_id:</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos">791</span></a><span class="sd">        print(f&quot;Data uploaded successfully with ID: {data_id}&quot;)</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos">792</span></a><span class="sd">    else:</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos">793</span></a><span class="sd">        print(&quot;Failed to upload data&quot;)</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos">794</span></a><span class="sd">    ```</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos">795</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos">796</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/pipedata/</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># the metadata contain session_id to consistently pass it with each upload</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos">797</span></a>
</span><span id="L-798"><a href="#L-798"><span class="linenos">798</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos">799</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos">800</span></a>        <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos">801</span></a>        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos">802</span></a>        <span class="s2">&quot;ppg_red&quot;</span><span class="p">:</span> <span class="n">ppg_red</span><span class="p">,</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos">803</span></a>        <span class="s2">&quot;ppg_ir&quot;</span><span class="p">:</span> <span class="n">ppg_ir</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos">804</span></a>    <span class="p">}</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos">805</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos">806</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos">807</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos">808</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos">809</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos">810</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos">811</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos">812</span></a>    <span class="p">)</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos">813</span></a>
</span><span id="L-814"><a href="#L-814"><span class="linenos">814</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos">815</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos">816</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos">817</span></a>        <span class="n">data_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_id&#39;</span><span class="p">)</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos">818</span></a>        <span class="c1"># Retrieve the processed data</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos">819</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pipeData&#39;</span><span class="p">)</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos">820</span></a>        <span class="k">return</span> <span class="n">data_id</span><span class="p">,</span> <span class="n">data</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos">821</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos">822</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upload failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos">823</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos">824</span></a>
</span><span id="L-825"><a href="#L-825"><span class="linenos">825</span></a>
</span><span id="L-826"><a href="#L-826"><span class="linenos">826</span></a><span class="c1">######################################################</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos">827</span></a><span class="k">def</span> <span class="nf">acquire_send_pipe</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos">828</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos">829</span></a><span class="sd">    Acquires data from a board, processes it according to a specified pipeline, and sends it to a server.</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos">830</span></a><span class="sd">    This function handles setting up a session for data acquisition and processing, connects to a board, </span>
</span><span id="L-831"><a href="#L-831"><span class="linenos">831</span></a><span class="sd">    and manages the data flow from acquisition through processing to uploading. It uses an asynchronous loop</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos">832</span></a><span class="sd">    to handle the operations efficiently, suitable for real-time data processing scenarios.</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos">833</span></a>
</span><span id="L-834"><a href="#L-834"><span class="linenos">834</span></a><span class="sd">    Args:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos">835</span></a><span class="sd">    **pipeline** (*str*): Name of the processing pipeline to use.     </span>
</span><span id="L-836"><a href="#L-836"><span class="linenos">836</span></a><span class="sd">    **params** (*dict*): Parameters for the pipeline processing.      </span>
</span><span id="L-837"><a href="#L-837"><span class="linenos">837</span></a><span class="sd">    **user_id** (*str*): The user ID to which the session will be associated.      </span>
</span><span id="L-838"><a href="#L-838"><span class="linenos">838</span></a><span class="sd">    **date** (*str*): Date of the session for tracking purposes.      </span>
</span><span id="L-839"><a href="#L-839"><span class="linenos">839</span></a><span class="sd">    **board** (*int*): Identifier for the hardware board to use for data acquisition.      </span>
</span><span id="L-840"><a href="#L-840"><span class="linenos">840</span></a><span class="sd">    **stream_duration** (*int*): Duration in seconds to stream data from the board.     </span>
</span><span id="L-841"><a href="#L-841"><span class="linenos">841</span></a><span class="sd">    **buffer_duration** (*int*): Duration in seconds to buffer data before processing.      </span>
</span><span id="L-842"><a href="#L-842"><span class="linenos">842</span></a><span class="sd">    **callback** (*function*): Optional callback function to execute after data is sent.</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos">843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos">844</span></a><span class="sd">    Returns:    </span>
</span><span id="L-845"><a href="#L-845"><span class="linenos">845</span></a><span class="sd">        *str* or *bool*: The session ID if successful, False otherwise.</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos">846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos">847</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos">848</span></a>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> 
</span><span id="L-849"><a href="#L-849"><span class="linenos">849</span></a>        <span class="n">_acquire_send_pipe</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> 
</span><span id="L-850"><a href="#L-850"><span class="linenos">850</span></a>    <span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos">851</span></a>    <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos">852</span></a>
</span><span id="L-853"><a href="#L-853"><span class="linenos">853</span></a><span class="k">async</span> <span class="k">def</span> <span class="nf">_acquire_send_pipe</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos">854</span></a>    <span class="c1"># get board</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos">855</span></a>    <span class="n">board_manager</span> <span class="o">=</span> <span class="n">BoardManager</span><span class="p">(</span><span class="n">enable_logger</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">board_id</span><span class="o">=</span><span class="n">board</span><span class="p">)</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos">856</span></a>    <span class="n">board_manager</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos">857</span></a>
</span><span id="L-858"><a href="#L-858"><span class="linenos">858</span></a>    <span class="c1"># set session for the data</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos">859</span></a>    <span class="c1"># We set a session id for the current interaction with the API (even if we fail to get the board, it will be important to store the failure)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos">860</span></a>    <span class="n">session_metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos">861</span></a>      <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="c1"># add user to the session for reference</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos">862</span></a>      <span class="s2">&quot;session_date&quot;</span><span class="p">:</span> <span class="n">date</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos">863</span></a>    <span class="p">}</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos">864</span></a>    <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">session_metadata</span><span class="p">,</span> <span class="s2">&quot;sessionSchema&quot;</span><span class="p">):</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos">865</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">set_pipe</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">session_metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">board_manager</span><span class="o">.</span><span class="n">metadata</span><span class="p">},</span> <span class="n">pipeline</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos">866</span></a>        <span class="n">board_manager</span><span class="o">.</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span> <span class="c1"># add session to the data for reference</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos">867</span></a>
</span><span id="L-868"><a href="#L-868"><span class="linenos">868</span></a>        <span class="c1"># stream_duration sec, buffer_duration sec</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos">869</span></a>        <span class="k">await</span> <span class="n">board_manager</span><span class="o">.</span><span class="n">data_acquisition_loop</span><span class="p">(</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos">870</span></a>            <span class="n">stream_duration</span><span class="o">=</span><span class="n">stream_duration</span><span class="p">,</span> 
</span><span id="L-871"><a href="#L-871"><span class="linenos">871</span></a>            <span class="n">buffer_duration</span><span class="o">=</span><span class="n">buffer_duration</span><span class="p">,</span> 
</span><span id="L-872"><a href="#L-872"><span class="linenos">872</span></a>            <span class="n">service</span><span class="o">=</span><span class="n">upload_pipedata</span><span class="p">,</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos">873</span></a>            <span class="n">callback</span><span class="o">=</span><span class="n">callback</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos">874</span></a>        <span class="p">)</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos">875</span></a>
</span><span id="L-876"><a href="#L-876"><span class="linenos">876</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos">877</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos">878</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos">879</span></a>
</span><span id="L-880"><a href="#L-880"><span class="linenos">880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos">881</span></a><span class="c1">######################################################</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos">882</span></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos">883</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos">884</span></a><span class="sd">    Sends a request to the server to train a machine learning algorithm on the data from a specified session.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos">885</span></a>
</span><span id="L-886"><a href="#L-886"><span class="linenos">886</span></a><span class="sd">    Args:     </span>
</span><span id="L-887"><a href="#L-887"><span class="linenos">887</span></a><span class="sd">    **session_id** (*str*): The unique identifier of the session containing the data to be used for training.       </span>
</span><span id="L-888"><a href="#L-888"><span class="linenos">888</span></a><span class="sd">    **params** (*dict*): The parameters for the training process.</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos">889</span></a>
</span><span id="L-890"><a href="#L-890"><span class="linenos">890</span></a><span class="sd">    Returns:      </span>
</span><span id="L-891"><a href="#L-891"><span class="linenos">891</span></a><span class="sd">        *str* or *None*: The task ID if the request is successful, None otherwise.</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos">892</span></a>
</span><span id="L-893"><a href="#L-893"><span class="linenos">893</span></a><span class="sd">    This function sends the training parameters and session ID to the server, which initiates the training process.</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos">894</span></a><span class="sd">    The response includes a task ID that can be used for future interactions related to the training task.</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos">895</span></a>
</span><span id="L-896"><a href="#L-896"><span class="linenos">896</span></a><span class="sd">    Example:</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos">897</span></a><span class="sd">    ```</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos">898</span></a><span class="sd">    train(&quot;session_12345&quot;, {&quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;})</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos">899</span></a><span class="sd">    ```</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos">900</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos">901</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/train/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos">902</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos">903</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos">904</span></a>    <span class="p">}</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos">905</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos">906</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos">907</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos">908</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos">909</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos">910</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos">911</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos">912</span></a>    <span class="p">)</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos">913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos">914</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos">915</span></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos">916</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Published. For future interactions, use task_id:&quot;</span><span class="p">,</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos">917</span></a>        <span class="k">return</span> <span class="n">task_id</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos">918</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos">919</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Publish failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos">920</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos">921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos">922</span></a>
</span><span id="L-923"><a href="#L-923"><span class="linenos">923</span></a><span class="c1">######################################################</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos">924</span></a><span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="n">data_id</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos">925</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos">926</span></a><span class="sd">    Sends a request to the server to perform machine learning inference based on a previously trained model, given the data ID.</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos">927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos">928</span></a><span class="sd">    Args:     </span>
</span><span id="L-929"><a href="#L-929"><span class="linenos">929</span></a><span class="sd">    **data_id** (*str*): The unique identifier of the data to be used for inference.      </span>
</span><span id="L-930"><a href="#L-930"><span class="linenos">930</span></a><span class="sd">    **params** (*dict*): The parameters for the inference process.</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos">931</span></a>
</span><span id="L-932"><a href="#L-932"><span class="linenos">932</span></a><span class="sd">    Returns:</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos">933</span></a><span class="sd">    *str* or *None*: The task ID if the request is successful, None otherwise.</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos">934</span></a>
</span><span id="L-935"><a href="#L-935"><span class="linenos">935</span></a><span class="sd">    This function sends the inference parameters and data ID to the server, which initiates the inference process.</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos">936</span></a><span class="sd">    The response includes a task ID that can be used for future interactions related to the inference task.</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos">937</span></a>
</span><span id="L-938"><a href="#L-938"><span class="linenos">938</span></a><span class="sd">    Example:</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos">939</span></a><span class="sd">    ```</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos">940</span></a><span class="sd">    infer(&quot;data_12345&quot;, {&quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;})</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos">941</span></a><span class="sd">    ```</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos">942</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos">943</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/infer/</span><span class="si">{</span><span class="n">data_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos">944</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos">945</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos">946</span></a>    <span class="p">}</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos">947</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos">948</span></a>    <span class="c1"># response = requests.post(url, json=_params)</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos">949</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos">950</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos">951</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos">952</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos">953</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos">954</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos">955</span></a>    <span class="p">)</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos">956</span></a>    
</span><span id="L-957"><a href="#L-957"><span class="linenos">957</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos">958</span></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">)</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos">959</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Published. For future interactions, use task_id:&quot;</span><span class="p">,</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos">960</span></a>        <span class="k">return</span> <span class="n">task_id</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos">961</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos">962</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Publish failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos">963</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos">964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos">965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos">966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos">967</span></a><span class="c1">############################</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos">968</span></a><span class="c1"># BrainOS - HABSlib - TODO #</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos">969</span></a><span class="c1">############################</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos">970</span></a><span class="c1"># </span>
</span><span id="L-971"><a href="#L-971"><span class="linenos">971</span></a><span class="c1"># - Encryption:</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos">972</span></a><span class="c1">#       - Client side:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos">973</span></a><span class="c1">#           2.    Client starts handshake (GET)</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos">974</span></a><span class="c1">#           4.    Client receives the public RSA and stores it.</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos">975</span></a><span class="c1">#           5.    Client encrypts the AES key using the server&#39;s RSA public key and sends it to the server.</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos">976</span></a><span class="c1">#           7.    All subsequent communications use the AES key for encryption and decryption, ensuring fast and secure data exchange.</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos">977</span></a><span class="c1"># </span>
</span><span id="L-978"><a href="#L-978"><span class="linenos">978</span></a><span class="c1"># - Unit Test:</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos">979</span></a><span class="c1">#       - the file client.py is the base for testing habslib</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos">980</span></a><span class="c1">#       - Low level unit test: for single-use function in this file, and BoradManager</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos">981</span></a><span class="c1">#       - High level unit test: fixtures for creating the session, sending data and retrieving</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos">982</span></a><span class="c1">#       - Tests are on demand, not necessarily for every commit. But for each major change yes.</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos">983</span></a><span class="c1"># </span>
</span><span id="L-984"><a href="#L-984"><span class="linenos">984</span></a><span class="c1"># - Code coverage</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos">985</span></a><span class="c1"># </span>
</span><span id="L-986"><a href="#L-986"><span class="linenos">986</span></a><span class="c1"># - Reviewer:</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos">987</span></a><span class="c1">#       Human</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos">988</span></a><span class="c1">#       Automated (unit test passing GitLab Ops)</span>
</span></pre></div>


            </section>
                <section id="validate_metadata">
                            <input id="validate_metadata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">validate_metadata</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">metadata</span>, </span><span class="param"><span class="n">schema_name</span>, </span><span class="param"><span class="n">schemafile</span><span class="o">=</span><span class="s1">&#39;metadata.json&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="validate_metadata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#validate_metadata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="validate_metadata-70"><a href="#validate_metadata-70"><span class="linenos"> 70</span></a><span class="k">def</span> <span class="nf">validate_metadata</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">schema_name</span><span class="p">,</span> <span class="n">schemafile</span><span class="o">=</span><span class="s1">&#39;metadata.json&#39;</span><span class="p">):</span>
</span><span id="validate_metadata-71"><a href="#validate_metadata-71"><span class="linenos"> 71</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="validate_metadata-72"><a href="#validate_metadata-72"><span class="linenos"> 72</span></a><span class="sd">    Validate metadata against a given JSON schema.</span>
</span><span id="validate_metadata-73"><a href="#validate_metadata-73"><span class="linenos"> 73</span></a>
</span><span id="validate_metadata-74"><a href="#validate_metadata-74"><span class="linenos"> 74</span></a><span class="sd">    Args:    </span>
</span><span id="validate_metadata-75"><a href="#validate_metadata-75"><span class="linenos"> 75</span></a><span class="sd">        **metadata** (*dict*): The metadata to be validated.    </span>
</span><span id="validate_metadata-76"><a href="#validate_metadata-76"><span class="linenos"> 76</span></a><span class="sd">        **schema_name** (*str*): The name of the schema to validate against. HABSlib currently supports the validation of Session metadata and User data.    </span>
</span><span id="validate_metadata-77"><a href="#validate_metadata-77"><span class="linenos"> 77</span></a><span class="sd">        **schemafile** (*str*, optional): The path to the JSON file containing the schemas. Defaults to &#39;metadata.json&#39;.    </span>
</span><span id="validate_metadata-78"><a href="#validate_metadata-78"><span class="linenos"> 78</span></a>
</span><span id="validate_metadata-79"><a href="#validate_metadata-79"><span class="linenos"> 79</span></a><span class="sd">    Returns:    </span>
</span><span id="validate_metadata-80"><a href="#validate_metadata-80"><span class="linenos"> 80</span></a><span class="sd">        *bool*: True if validation is successful, False otherwise.</span>
</span><span id="validate_metadata-81"><a href="#validate_metadata-81"><span class="linenos"> 81</span></a>
</span><span id="validate_metadata-82"><a href="#validate_metadata-82"><span class="linenos"> 82</span></a><span class="sd">    Raises:    </span>
</span><span id="validate_metadata-83"><a href="#validate_metadata-83"><span class="linenos"> 83</span></a><span class="sd">        **FileNotFoundError**: If the schema file does not exist.     </span>
</span><span id="validate_metadata-84"><a href="#validate_metadata-84"><span class="linenos"> 84</span></a><span class="sd">        **json.JSONDecodeError**: If there is an error decoding the JSON schema file.     </span>
</span><span id="validate_metadata-85"><a href="#validate_metadata-85"><span class="linenos"> 85</span></a><span class="sd">        **exceptions.ValidationError**: If the metadata does not conform to the schema.     </span>
</span><span id="validate_metadata-86"><a href="#validate_metadata-86"><span class="linenos"> 86</span></a><span class="sd">        **Exception**: For any other errors that occur during validation.     </span>
</span><span id="validate_metadata-87"><a href="#validate_metadata-87"><span class="linenos"> 87</span></a>
</span><span id="validate_metadata-88"><a href="#validate_metadata-88"><span class="linenos"> 88</span></a><span class="sd">    Example:</span>
</span><span id="validate_metadata-89"><a href="#validate_metadata-89"><span class="linenos"> 89</span></a><span class="sd">    ```</span>
</span><span id="validate_metadata-90"><a href="#validate_metadata-90"><span class="linenos"> 90</span></a><span class="sd">    metadata = {&quot;name&quot;: &quot;example&quot;, &quot;type&quot;: &quot;data&quot;}</span>
</span><span id="validate_metadata-91"><a href="#validate_metadata-91"><span class="linenos"> 91</span></a><span class="sd">    schema_name = &quot;example_schema&quot;</span>
</span><span id="validate_metadata-92"><a href="#validate_metadata-92"><span class="linenos"> 92</span></a><span class="sd">    is_valid = validate_metadata(metadata, schema_name)</span>
</span><span id="validate_metadata-93"><a href="#validate_metadata-93"><span class="linenos"> 93</span></a><span class="sd">    if is_valid:</span>
</span><span id="validate_metadata-94"><a href="#validate_metadata-94"><span class="linenos"> 94</span></a><span class="sd">        print(&quot;Metadata is valid.&quot;)</span>
</span><span id="validate_metadata-95"><a href="#validate_metadata-95"><span class="linenos"> 95</span></a><span class="sd">    else:</span>
</span><span id="validate_metadata-96"><a href="#validate_metadata-96"><span class="linenos"> 96</span></a><span class="sd">        print(&quot;Metadata is invalid.&quot;)</span>
</span><span id="validate_metadata-97"><a href="#validate_metadata-97"><span class="linenos"> 97</span></a><span class="sd">    ```</span>
</span><span id="validate_metadata-98"><a href="#validate_metadata-98"><span class="linenos"> 98</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="validate_metadata-99"><a href="#validate_metadata-99"><span class="linenos"> 99</span></a>
</span><span id="validate_metadata-100"><a href="#validate_metadata-100"><span class="linenos">100</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="validate_metadata-101"><a href="#validate_metadata-101"><span class="linenos">101</span></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="n">schemafile</span><span class="p">),</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="validate_metadata-102"><a href="#validate_metadata-102"><span class="linenos">102</span></a>            <span class="n">content</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="validate_metadata-103"><a href="#validate_metadata-103"><span class="linenos">103</span></a>            <span class="n">schemas</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span><span id="validate_metadata-104"><a href="#validate_metadata-104"><span class="linenos">104</span></a>        <span class="n">schema</span> <span class="o">=</span> <span class="n">schemas</span><span class="p">[</span><span class="n">schema_name</span><span class="p">]</span>
</span><span id="validate_metadata-105"><a href="#validate_metadata-105"><span class="linenos">105</span></a>        <span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span> <span class="n">schema</span><span class="o">=</span><span class="n">schema</span><span class="p">)</span> <span class="c1">#, format_checker=FormatChecker())</span>
</span><span id="validate_metadata-106"><a href="#validate_metadata-106"><span class="linenos">106</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Metadata validation successful!&quot;</span><span class="p">)</span>
</span><span id="validate_metadata-107"><a href="#validate_metadata-107"><span class="linenos">107</span></a>        <span class="k">return</span> <span class="kc">True</span>
</span><span id="validate_metadata-108"><a href="#validate_metadata-108"><span class="linenos">108</span></a>
</span><span id="validate_metadata-109"><a href="#validate_metadata-109"><span class="linenos">109</span></a>    <span class="k">except</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="validate_metadata-110"><a href="#validate_metadata-110"><span class="linenos">110</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to decode JSON:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="validate_metadata-111"><a href="#validate_metadata-111"><span class="linenos">111</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validate_metadata-112"><a href="#validate_metadata-112"><span class="linenos">112</span></a>
</span><span id="validate_metadata-113"><a href="#validate_metadata-113"><span class="linenos">113</span></a>    <span class="k">except</span> <span class="n">exceptions</span><span class="o">.</span><span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="validate_metadata-114"><a href="#validate_metadata-114"><span class="linenos">114</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Validation error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="validate_metadata-115"><a href="#validate_metadata-115"><span class="linenos">115</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validate_metadata-116"><a href="#validate_metadata-116"><span class="linenos">116</span></a>
</span><span id="validate_metadata-117"><a href="#validate_metadata-117"><span class="linenos">117</span></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="validate_metadata-118"><a href="#validate_metadata-118"><span class="linenos">118</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No such file: </span><span class="si">{</span><span class="n">schemafile</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="validate_metadata-119"><a href="#validate_metadata-119"><span class="linenos">119</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span><span id="validate_metadata-120"><a href="#validate_metadata-120"><span class="linenos">120</span></a>
</span><span id="validate_metadata-121"><a href="#validate_metadata-121"><span class="linenos">121</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="validate_metadata-122"><a href="#validate_metadata-122"><span class="linenos">122</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A general error occurred:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="validate_metadata-123"><a href="#validate_metadata-123"><span class="linenos">123</span></a>        <span class="k">return</span> <span class="kc">False</span>
</span></pre></div>


            <div class="docstring"><p>Validate metadata against a given JSON schema.</p>

<p>Args: <br />
    <strong>metadata</strong> (<em>dict</em>): The metadata to be validated. <br />
    <strong>schema_name</strong> (<em>str</em>): The name of the schema to validate against. HABSlib currently supports the validation of Session metadata and User data. <br />
    <strong>schemafile</strong> (<em>str</em>, optional): The path to the JSON file containing the schemas. Defaults to 'metadata.json'.    </p>

<p>Returns: <br />
    <em>bool</em>: True if validation is successful, False otherwise.</p>

<p>Raises: <br />
    <strong>FileNotFoundError</strong>: If the schema file does not exist. <br />
    <strong>json.JSONDecodeError</strong>: If there is an error decoding the JSON schema file. <br />
    <strong>exceptions.ValidationError</strong>: If the metadata does not conform to the schema. <br />
    <strong>Exception</strong>: For any other errors that occur during validation.     </p>

<p>Example:</p>

<pre><code>metadata = {"name": "example", "type": "data"}
schema_name = "example_schema"
is_valid = validate_metadata(metadata, schema_name)
if is_valid:
    print("Metadata is valid.")
else:
    print("Metadata is invalid.")
</code></pre>
</div>


                </section>
                <section id="convert_datetime_in_dict">
                            <input id="convert_datetime_in_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_datetime_in_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="convert_datetime_in_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert_datetime_in_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert_datetime_in_dict-126"><a href="#convert_datetime_in_dict-126"><span class="linenos">126</span></a><span class="k">def</span> <span class="nf">convert_datetime_in_dict</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="convert_datetime_in_dict-127"><a href="#convert_datetime_in_dict-127"><span class="linenos">127</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="convert_datetime_in_dict-128"><a href="#convert_datetime_in_dict-128"><span class="linenos">128</span></a><span class="sd">    Recursively converts all datetime objects in a dictionary to strings in ISO format.</span>
</span><span id="convert_datetime_in_dict-129"><a href="#convert_datetime_in_dict-129"><span class="linenos">129</span></a>
</span><span id="convert_datetime_in_dict-130"><a href="#convert_datetime_in_dict-130"><span class="linenos">130</span></a><span class="sd">    Args:     </span>
</span><span id="convert_datetime_in_dict-131"><a href="#convert_datetime_in_dict-131"><span class="linenos">131</span></a><span class="sd">        **data** (*dict*): The dictionary containing the data.</span>
</span><span id="convert_datetime_in_dict-132"><a href="#convert_datetime_in_dict-132"><span class="linenos">132</span></a>
</span><span id="convert_datetime_in_dict-133"><a href="#convert_datetime_in_dict-133"><span class="linenos">133</span></a><span class="sd">    Returns:     </span>
</span><span id="convert_datetime_in_dict-134"><a href="#convert_datetime_in_dict-134"><span class="linenos">134</span></a><span class="sd">        *dict*: The dictionary with datetime objects converted to strings.</span>
</span><span id="convert_datetime_in_dict-135"><a href="#convert_datetime_in_dict-135"><span class="linenos">135</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="convert_datetime_in_dict-136"><a href="#convert_datetime_in_dict-136"><span class="linenos">136</span></a>    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="convert_datetime_in_dict-137"><a href="#convert_datetime_in_dict-137"><span class="linenos">137</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">datetime</span><span class="p">):</span>
</span><span id="convert_datetime_in_dict-138"><a href="#convert_datetime_in_dict-138"><span class="linenos">138</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
</span><span id="convert_datetime_in_dict-139"><a href="#convert_datetime_in_dict-139"><span class="linenos">139</span></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="convert_datetime_in_dict-140"><a href="#convert_datetime_in_dict-140"><span class="linenos">140</span></a>            <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="convert_datetime_in_dict-141"><a href="#convert_datetime_in_dict-141"><span class="linenos">141</span></a>    <span class="k">return</span> <span class="n">data</span>
</span></pre></div>


            <div class="docstring"><p>Recursively converts all datetime objects in a dictionary to strings in ISO format.</p>

<p>Args: <br />
    <strong>data</strong> (<em>dict</em>): The dictionary containing the data.</p>

<p>Returns: <br />
    <em>dict</em>: The dictionary with datetime objects converted to strings.</p>
</div>


                </section>
                <section id="handshake">
                            <input id="handshake-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">handshake</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">base_url</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="handshake-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#handshake"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="handshake-145"><a href="#handshake-145"><span class="linenos">145</span></a><span class="k">def</span> <span class="nf">handshake</span><span class="p">(</span><span class="n">base_url</span><span class="p">):</span>  
</span><span id="handshake-146"><a href="#handshake-146"><span class="linenos">146</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="handshake-147"><a href="#handshake-147"><span class="linenos">147</span></a><span class="sd">    Perform a handshake with the server to exchange encryption keys for the current session.</span>
</span><span id="handshake-148"><a href="#handshake-148"><span class="linenos">148</span></a>
</span><span id="handshake-149"><a href="#handshake-149"><span class="linenos">149</span></a><span class="sd">    This function performs the following steps:</span>
</span><span id="handshake-150"><a href="#handshake-150"><span class="linenos">150</span></a><span class="sd">    0. Performs login to the HABS server.</span>
</span><span id="handshake-151"><a href="#handshake-151"><span class="linenos">151</span></a><span class="sd">    1. Sends a GET request to the server to initiate an RSA handshake.</span>
</span><span id="handshake-152"><a href="#handshake-152"><span class="linenos">152</span></a><span class="sd">    2. Retrieves the server&#39;s public RSA key from the response.</span>
</span><span id="handshake-153"><a href="#handshake-153"><span class="linenos">153</span></a><span class="sd">    3. Generates a local AES key and stores it in the environment.</span>
</span><span id="handshake-154"><a href="#handshake-154"><span class="linenos">154</span></a><span class="sd">    4. Encrypts the AES key with the server&#39;s RSA key.</span>
</span><span id="handshake-155"><a href="#handshake-155"><span class="linenos">155</span></a><span class="sd">    5. Sends the encrypted AES key to the server to complete the AES handshake.</span>
</span><span id="handshake-156"><a href="#handshake-156"><span class="linenos">156</span></a>
</span><span id="handshake-157"><a href="#handshake-157"><span class="linenos">157</span></a><span class="sd">    Args:      </span>
</span><span id="handshake-158"><a href="#handshake-158"><span class="linenos">158</span></a><span class="sd">        **base_url** (*str*): The base URL of the server&#39;s API.</span>
</span><span id="handshake-159"><a href="#handshake-159"><span class="linenos">159</span></a>
</span><span id="handshake-160"><a href="#handshake-160"><span class="linenos">160</span></a><span class="sd">    Returns:     </span>
</span><span id="handshake-161"><a href="#handshake-161"><span class="linenos">161</span></a><span class="sd">        *bool*: True if the handshake is successful, None otherwise.</span>
</span><span id="handshake-162"><a href="#handshake-162"><span class="linenos">162</span></a>
</span><span id="handshake-163"><a href="#handshake-163"><span class="linenos">163</span></a><span class="sd">    Raises:      </span>
</span><span id="handshake-164"><a href="#handshake-164"><span class="linenos">164</span></a><span class="sd">        **requests.RequestException**: If a request to the server fails.</span>
</span><span id="handshake-165"><a href="#handshake-165"><span class="linenos">165</span></a>
</span><span id="handshake-166"><a href="#handshake-166"><span class="linenos">166</span></a><span class="sd">    Example:</span>
</span><span id="handshake-167"><a href="#handshake-167"><span class="linenos">167</span></a><span class="sd">    ```</span>
</span><span id="handshake-168"><a href="#handshake-168"><span class="linenos">168</span></a><span class="sd">    success = handshake(&quot;https://example.com&quot;)</span>
</span><span id="handshake-169"><a href="#handshake-169"><span class="linenos">169</span></a><span class="sd">    if success:</span>
</span><span id="handshake-170"><a href="#handshake-170"><span class="linenos">170</span></a><span class="sd">        print(&quot;Handshake completed successfully.&quot;)</span>
</span><span id="handshake-171"><a href="#handshake-171"><span class="linenos">171</span></a><span class="sd">    else:</span>
</span><span id="handshake-172"><a href="#handshake-172"><span class="linenos">172</span></a><span class="sd">        print(&quot;Handshake failed.&quot;)</span>
</span><span id="handshake-173"><a href="#handshake-173"><span class="linenos">173</span></a><span class="sd">    ```</span>
</span><span id="handshake-174"><a href="#handshake-174"><span class="linenos">174</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="handshake-175"><a href="#handshake-175"><span class="linenos">175</span></a>    <span class="k">global</span> <span class="n">BASE_URL</span>
</span><span id="handshake-176"><a href="#handshake-176"><span class="linenos">176</span></a>    <span class="n">BASE_URL</span> <span class="o">=</span> <span class="n">base_url</span>
</span><span id="handshake-177"><a href="#handshake-177"><span class="linenos">177</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/handshake_rsa&quot;</span>
</span><span id="handshake-178"><a href="#handshake-178"><span class="linenos">178</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="handshake-179"><a href="#handshake-179"><span class="linenos">179</span></a>
</span><span id="handshake-180"><a href="#handshake-180"><span class="linenos">180</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="handshake-181"><a href="#handshake-181"><span class="linenos">181</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (RSA) successful.&quot;</span><span class="p">)</span>
</span><span id="handshake-182"><a href="#handshake-182"><span class="linenos">182</span></a>        <span class="n">api_public_key_pem</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;api_public_key&#39;</span><span class="p">)</span>
</span><span id="handshake-183"><a href="#handshake-183"><span class="linenos">183</span></a>        <span class="n">api_public_key</span> <span class="o">=</span> <span class="n">serialization</span><span class="o">.</span><span class="n">load_pem_public_key</span><span class="p">(</span>
</span><span id="handshake-184"><a href="#handshake-184"><span class="linenos">184</span></a>            <span class="n">api_public_key_pem</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
</span><span id="handshake-185"><a href="#handshake-185"><span class="linenos">185</span></a>            <span class="n">backend</span><span class="o">=</span><span class="n">default_backend</span><span class="p">()</span>
</span><span id="handshake-186"><a href="#handshake-186"><span class="linenos">186</span></a>        <span class="p">)</span>
</span><span id="handshake-187"><a href="#handshake-187"><span class="linenos">187</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;API_PUBLIC_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">api_public_key_pem</span>
</span><span id="handshake-188"><a href="#handshake-188"><span class="linenos">188</span></a>
</span><span id="handshake-189"><a href="#handshake-189"><span class="linenos">189</span></a>        <span class="c1"># Then we generate and store the AES key</span>
</span><span id="handshake-190"><a href="#handshake-190"><span class="linenos">190</span></a>        <span class="n">aes_key</span> <span class="o">=</span> <span class="n">generate_aes_key</span><span class="p">()</span>
</span><span id="handshake-191"><a href="#handshake-191"><span class="linenos">191</span></a>        <span class="c1"># print(&quot;aes_key&quot;, aes_key)</span>
</span><span id="handshake-192"><a href="#handshake-192"><span class="linenos">192</span></a>        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span> <span class="n">aes_key</span> <span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="handshake-193"><a href="#handshake-193"><span class="linenos">193</span></a>
</span><span id="handshake-194"><a href="#handshake-194"><span class="linenos">194</span></a>        <span class="n">encrypted_aes_key</span> <span class="o">=</span> <span class="n">encrypt_aes_key_with_rsa</span><span class="p">(</span><span class="n">aes_key</span><span class="p">,</span> <span class="n">api_public_key</span><span class="p">)</span>
</span><span id="handshake-195"><a href="#handshake-195"><span class="linenos">195</span></a>        <span class="n">encrypted_aes_key_b64</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">encrypted_aes_key</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="handshake-196"><a href="#handshake-196"><span class="linenos">196</span></a>        <span class="c1"># print(&quot;encrypted_aes_key_b64&quot;,encrypted_aes_key_b64)</span>
</span><span id="handshake-197"><a href="#handshake-197"><span class="linenos">197</span></a>        <span class="n">aes_key_payload</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="handshake-198"><a href="#handshake-198"><span class="linenos">198</span></a>            <span class="s2">&quot;encrypted_aes_key&quot;</span><span class="p">:</span> <span class="n">encrypted_aes_key_b64</span>
</span><span id="handshake-199"><a href="#handshake-199"><span class="linenos">199</span></a>        <span class="p">}</span>
</span><span id="handshake-200"><a href="#handshake-200"><span class="linenos">200</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/handshake_aes&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">aes_key_payload</span><span class="p">)</span>
</span><span id="handshake-201"><a href="#handshake-201"><span class="linenos">201</span></a>
</span><span id="handshake-202"><a href="#handshake-202"><span class="linenos">202</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="handshake-203"><a href="#handshake-203"><span class="linenos">203</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (AES) successful.&quot;</span><span class="p">)</span>
</span><span id="handshake-204"><a href="#handshake-204"><span class="linenos">204</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="handshake-205"><a href="#handshake-205"><span class="linenos">205</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="handshake-206"><a href="#handshake-206"><span class="linenos">206</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (AES) failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="handshake-207"><a href="#handshake-207"><span class="linenos">207</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="handshake-208"><a href="#handshake-208"><span class="linenos">208</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="handshake-209"><a href="#handshake-209"><span class="linenos">209</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Handshake (RSA) failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="handshake-210"><a href="#handshake-210"><span class="linenos">210</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Perform a handshake with the server to exchange encryption keys for the current session.</p>

<p>This function performs the following steps:</p>

<ol start="0">
<li>Performs login to the HABS server.</li>
<li>Sends a GET request to the server to initiate an RSA handshake.</li>
<li>Retrieves the server's public RSA key from the response.</li>
<li>Generates a local AES key and stores it in the environment.</li>
<li>Encrypts the AES key with the server's RSA key.</li>
<li>Sends the encrypted AES key to the server to complete the AES handshake.</li>
</ol>

<p>Args: <br />
    <strong>base_url</strong> (<em>str</em>): The base URL of the server's API.</p>

<p>Returns: <br />
    <em>bool</em>: True if the handshake is successful, None otherwise.</p>

<p>Raises: <br />
    <strong>requests.RequestException</strong>: If a request to the server fails.</p>

<p>Example:</p>

<pre><code>success = handshake("https://example.com")
if success:
    print("Handshake completed successfully.")
else:
    print("Handshake failed.")
</code></pre>
</div>


                </section>
                <section id="set_user">
                            <input id="set_user-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_user</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">first_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">last_name</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">email</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">age</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">weight</span><span class="o">=</span><span class="kc">None</span>,</span><span class="param">	<span class="n">gender</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_user-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_user"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_user-215"><a href="#set_user-215"><span class="linenos">215</span></a><span class="k">def</span> <span class="nf">set_user</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">email</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gender</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="set_user-216"><a href="#set_user-216"><span class="linenos">216</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_user-217"><a href="#set_user-217"><span class="linenos">217</span></a><span class="sd">    Creates a user by sending user data to the server.</span>
</span><span id="set_user-218"><a href="#set_user-218"><span class="linenos">218</span></a>
</span><span id="set_user-219"><a href="#set_user-219"><span class="linenos">219</span></a><span class="sd">    This function performs the following steps:</span>
</span><span id="set_user-220"><a href="#set_user-220"><span class="linenos">220</span></a><span class="sd">    1. Constructs the user data dictionary.</span>
</span><span id="set_user-221"><a href="#set_user-221"><span class="linenos">221</span></a><span class="sd">    2. Validates the user data against the &quot;userSchema&quot;.</span>
</span><span id="set_user-222"><a href="#set_user-222"><span class="linenos">222</span></a><span class="sd">    3. Encrypts the user data using the stored AES key.</span>
</span><span id="set_user-223"><a href="#set_user-223"><span class="linenos">223</span></a><span class="sd">    4. Sends the encrypted user data to the server.</span>
</span><span id="set_user-224"><a href="#set_user-224"><span class="linenos">224</span></a><span class="sd">    5. Handles the server&#39;s response.</span>
</span><span id="set_user-225"><a href="#set_user-225"><span class="linenos">225</span></a>
</span><span id="set_user-226"><a href="#set_user-226"><span class="linenos">226</span></a><span class="sd">    Args:     </span>
</span><span id="set_user-227"><a href="#set_user-227"><span class="linenos">227</span></a><span class="sd">    **first_name** (*str*, optional): The user&#39;s first name.      </span>
</span><span id="set_user-228"><a href="#set_user-228"><span class="linenos">228</span></a><span class="sd">    **last_name** (*str*, optional): The user&#39;s last name.     </span>
</span><span id="set_user-229"><a href="#set_user-229"><span class="linenos">229</span></a><span class="sd">    **email** (*str*, optional): The user&#39;s email address.     </span>
</span><span id="set_user-230"><a href="#set_user-230"><span class="linenos">230</span></a><span class="sd">    **age** (*int*, optional): The user&#39;s age.     </span>
</span><span id="set_user-231"><a href="#set_user-231"><span class="linenos">231</span></a><span class="sd">    **weight** (*float*, optional): The user&#39;s weight.     </span>
</span><span id="set_user-232"><a href="#set_user-232"><span class="linenos">232</span></a><span class="sd">    **gender** (*str*, optional): The user&#39;s gender.      </span>
</span><span id="set_user-233"><a href="#set_user-233"><span class="linenos">233</span></a>
</span><span id="set_user-234"><a href="#set_user-234"><span class="linenos">234</span></a><span class="sd">    Returns:       </span>
</span><span id="set_user-235"><a href="#set_user-235"><span class="linenos">235</span></a><span class="sd">        *str*: The user ID if the user is successfully created/retrieved, None otherwise.</span>
</span><span id="set_user-236"><a href="#set_user-236"><span class="linenos">236</span></a>
</span><span id="set_user-237"><a href="#set_user-237"><span class="linenos">237</span></a><span class="sd">    Example:</span>
</span><span id="set_user-238"><a href="#set_user-238"><span class="linenos">238</span></a><span class="sd">    ```</span>
</span><span id="set_user-239"><a href="#set_user-239"><span class="linenos">239</span></a><span class="sd">    user_id = set_user(first_name=&quot;John&quot;, last_name=&quot;Doe&quot;, email=&quot;john.doe@example.com&quot;, age=30, weight=70.5, gender=&quot;X&quot;)</span>
</span><span id="set_user-240"><a href="#set_user-240"><span class="linenos">240</span></a><span class="sd">    if user_id:</span>
</span><span id="set_user-241"><a href="#set_user-241"><span class="linenos">241</span></a><span class="sd">        print(f&quot;User created/retrieved with ID: {user_id}&quot;)</span>
</span><span id="set_user-242"><a href="#set_user-242"><span class="linenos">242</span></a><span class="sd">    else:</span>
</span><span id="set_user-243"><a href="#set_user-243"><span class="linenos">243</span></a><span class="sd">        print(&quot;User creation failed.&quot;)</span>
</span><span id="set_user-244"><a href="#set_user-244"><span class="linenos">244</span></a><span class="sd">    ```</span>
</span><span id="set_user-245"><a href="#set_user-245"><span class="linenos">245</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_user-246"><a href="#set_user-246"><span class="linenos">246</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users&quot;</span>
</span><span id="set_user-247"><a href="#set_user-247"><span class="linenos">247</span></a>    <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="set_user-248"><a href="#set_user-248"><span class="linenos">248</span></a>        <span class="s2">&quot;first_name&quot;</span><span class="p">:</span> <span class="n">first_name</span><span class="p">,</span> 
</span><span id="set_user-249"><a href="#set_user-249"><span class="linenos">249</span></a>        <span class="s2">&quot;last_name&quot;</span><span class="p">:</span> <span class="n">last_name</span><span class="p">,</span> 
</span><span id="set_user-250"><a href="#set_user-250"><span class="linenos">250</span></a>        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> 
</span><span id="set_user-251"><a href="#set_user-251"><span class="linenos">251</span></a>        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">age</span><span class="p">,</span> 
</span><span id="set_user-252"><a href="#set_user-252"><span class="linenos">252</span></a>        <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">weight</span><span class="p">,</span> 
</span><span id="set_user-253"><a href="#set_user-253"><span class="linenos">253</span></a>        <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="n">gender</span>
</span><span id="set_user-254"><a href="#set_user-254"><span class="linenos">254</span></a>    <span class="p">}</span>
</span><span id="set_user-255"><a href="#set_user-255"><span class="linenos">255</span></a>    <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="s2">&quot;userSchema&quot;</span><span class="p">,</span> <span class="p">):</span>
</span><span id="set_user-256"><a href="#set_user-256"><span class="linenos">256</span></a>        <span class="n">_user</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="set_user-257"><a href="#set_user-257"><span class="linenos">257</span></a>            <span class="s2">&quot;user_data&quot;</span><span class="p">:</span> <span class="n">user_data</span>
</span><span id="set_user-258"><a href="#set_user-258"><span class="linenos">258</span></a>        <span class="p">}</span>
</span><span id="set_user-259"><a href="#set_user-259"><span class="linenos">259</span></a>        <span class="n">_user</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_user</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="set_user-260"><a href="#set_user-260"><span class="linenos">260</span></a>        <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="set_user-261"><a href="#set_user-261"><span class="linenos">261</span></a>        <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="set_user-262"><a href="#set_user-262"><span class="linenos">262</span></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="set_user-263"><a href="#set_user-263"><span class="linenos">263</span></a>            <span class="n">url</span><span class="p">,</span>
</span><span id="set_user-264"><a href="#set_user-264"><span class="linenos">264</span></a>            <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_user</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="set_user-265"><a href="#set_user-265"><span class="linenos">265</span></a>            <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="set_user-266"><a href="#set_user-266"><span class="linenos">266</span></a>        <span class="p">)</span>
</span><span id="set_user-267"><a href="#set_user-267"><span class="linenos">267</span></a>
</span><span id="set_user-268"><a href="#set_user-268"><span class="linenos">268</span></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="set_user-269"><a href="#set_user-269"><span class="linenos">269</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User successfully created/retrieved.&quot;</span><span class="p">)</span>
</span><span id="set_user-270"><a href="#set_user-270"><span class="linenos">270</span></a>            <span class="n">user_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</span><span id="set_user-271"><a href="#set_user-271"><span class="linenos">271</span></a>            <span class="k">return</span> <span class="n">user_id</span>
</span><span id="set_user-272"><a href="#set_user-272"><span class="linenos">272</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="set_user-273"><a href="#set_user-273"><span class="linenos">273</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User creation failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="set_user-274"><a href="#set_user-274"><span class="linenos">274</span></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="set_user-275"><a href="#set_user-275"><span class="linenos">275</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="set_user-276"><a href="#set_user-276"><span class="linenos">276</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User creation failed.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Creates a user by sending user data to the server.</p>

<p>This function performs the following steps:</p>

<ol>
<li>Constructs the user data dictionary.</li>
<li>Validates the user data against the "userSchema".</li>
<li>Encrypts the user data using the stored AES key.</li>
<li>Sends the encrypted user data to the server.</li>
<li>Handles the server's response.</li>
</ol>

<p>Args: <br />
<strong>first_name</strong> (<em>str</em>, optional): The user's first name. <br />
<strong>last_name</strong> (<em>str</em>, optional): The user's last name. <br />
<strong>email</strong> (<em>str</em>, optional): The user's email address. <br />
<strong>age</strong> (<em>int</em>, optional): The user's age. <br />
<strong>weight</strong> (<em>float</em>, optional): The user's weight. <br />
<strong>gender</strong> (<em>str</em>, optional): The user's gender.      </p>

<p>Returns: <br />
    <em>str</em>: The user ID if the user is successfully created/retrieved, None otherwise.</p>

<p>Example:</p>

<pre><code>user_id = set_user(first_name="John", last_name="Doe", email="john.doe@example.com", age=30, weight=70.5, gender="X")
if user_id:
    print(f"User created/retrieved with ID: {user_id}")
else:
    print("User creation failed.")
</code></pre>
</div>


                </section>
                <section id="search_user_by_mail">
                            <input id="search_user_by_mail-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">search_user_by_mail</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">email</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="search_user_by_mail-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#search_user_by_mail"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="search_user_by_mail-280"><a href="#search_user_by_mail-280"><span class="linenos">280</span></a><span class="k">def</span> <span class="nf">search_user_by_mail</span><span class="p">(</span><span class="n">email</span><span class="p">):</span>
</span><span id="search_user_by_mail-281"><a href="#search_user_by_mail-281"><span class="linenos">281</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="search_user_by_mail-282"><a href="#search_user_by_mail-282"><span class="linenos">282</span></a><span class="sd">    Search for a user by email.</span>
</span><span id="search_user_by_mail-283"><a href="#search_user_by_mail-283"><span class="linenos">283</span></a>
</span><span id="search_user_by_mail-284"><a href="#search_user_by_mail-284"><span class="linenos">284</span></a><span class="sd">    This function sends a GET request to the server to search for a user by the provided email address.</span>
</span><span id="search_user_by_mail-285"><a href="#search_user_by_mail-285"><span class="linenos">285</span></a>
</span><span id="search_user_by_mail-286"><a href="#search_user_by_mail-286"><span class="linenos">286</span></a><span class="sd">    Args:     </span>
</span><span id="search_user_by_mail-287"><a href="#search_user_by_mail-287"><span class="linenos">287</span></a><span class="sd">        **email** (*str*): The email address of the user to search for.</span>
</span><span id="search_user_by_mail-288"><a href="#search_user_by_mail-288"><span class="linenos">288</span></a>
</span><span id="search_user_by_mail-289"><a href="#search_user_by_mail-289"><span class="linenos">289</span></a><span class="sd">    Returns:     </span>
</span><span id="search_user_by_mail-290"><a href="#search_user_by_mail-290"><span class="linenos">290</span></a><span class="sd">        *str*: The user ID if the user is found, None otherwise.</span>
</span><span id="search_user_by_mail-291"><a href="#search_user_by_mail-291"><span class="linenos">291</span></a>
</span><span id="search_user_by_mail-292"><a href="#search_user_by_mail-292"><span class="linenos">292</span></a><span class="sd">    Example:</span>
</span><span id="search_user_by_mail-293"><a href="#search_user_by_mail-293"><span class="linenos">293</span></a><span class="sd">    ```</span>
</span><span id="search_user_by_mail-294"><a href="#search_user_by_mail-294"><span class="linenos">294</span></a><span class="sd">    user_id = search_user_by_mail(&quot;john.doe@example.com&quot;)</span>
</span><span id="search_user_by_mail-295"><a href="#search_user_by_mail-295"><span class="linenos">295</span></a><span class="sd">    if user_id:</span>
</span><span id="search_user_by_mail-296"><a href="#search_user_by_mail-296"><span class="linenos">296</span></a><span class="sd">        print(f&quot;User found with ID: {user_id}&quot;)</span>
</span><span id="search_user_by_mail-297"><a href="#search_user_by_mail-297"><span class="linenos">297</span></a><span class="sd">    else:</span>
</span><span id="search_user_by_mail-298"><a href="#search_user_by_mail-298"><span class="linenos">298</span></a><span class="sd">        print(&quot;User not found.&quot;)</span>
</span><span id="search_user_by_mail-299"><a href="#search_user_by_mail-299"><span class="linenos">299</span></a><span class="sd">    ```</span>
</span><span id="search_user_by_mail-300"><a href="#search_user_by_mail-300"><span class="linenos">300</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="search_user_by_mail-301"><a href="#search_user_by_mail-301"><span class="linenos">301</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users?email=</span><span class="si">{</span><span class="n">email</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="search_user_by_mail-302"><a href="#search_user_by_mail-302"><span class="linenos">302</span></a>
</span><span id="search_user_by_mail-303"><a href="#search_user_by_mail-303"><span class="linenos">303</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="search_user_by_mail-304"><a href="#search_user_by_mail-304"><span class="linenos">304</span></a>
</span><span id="search_user_by_mail-305"><a href="#search_user_by_mail-305"><span class="linenos">305</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="search_user_by_mail-306"><a href="#search_user_by_mail-306"><span class="linenos">306</span></a>        <span class="n">user_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">)</span>
</span><span id="search_user_by_mail-307"><a href="#search_user_by_mail-307"><span class="linenos">307</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User found:&quot;</span><span class="p">,</span> <span class="n">user_id</span><span class="p">)</span>
</span><span id="search_user_by_mail-308"><a href="#search_user_by_mail-308"><span class="linenos">308</span></a>        <span class="k">return</span> <span class="n">user_id</span>
</span><span id="search_user_by_mail-309"><a href="#search_user_by_mail-309"><span class="linenos">309</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="search_user_by_mail-310"><a href="#search_user_by_mail-310"><span class="linenos">310</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found.&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="search_user_by_mail-311"><a href="#search_user_by_mail-311"><span class="linenos">311</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Search for a user by email.</p>

<p>This function sends a GET request to the server to search for a user by the provided email address.</p>

<p>Args: <br />
    <strong>email</strong> (<em>str</em>): The email address of the user to search for.</p>

<p>Returns: <br />
    <em>str</em>: The user ID if the user is found, None otherwise.</p>

<p>Example:</p>

<pre><code>user_id = search_user_by_mail("john.doe@example.com")
if user_id:
    print(f"User found with ID: {user_id}")
else:
    print("User not found.")
</code></pre>
</div>


                </section>
                <section id="get_user_by_id">
                            <input id="get_user_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_user_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_user_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_user_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_user_by_id-315"><a href="#get_user_by_id-315"><span class="linenos">315</span></a><span class="k">def</span> <span class="nf">get_user_by_id</span><span class="p">(</span><span class="n">user_id</span><span class="p">):</span>
</span><span id="get_user_by_id-316"><a href="#get_user_by_id-316"><span class="linenos">316</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_user_by_id-317"><a href="#get_user_by_id-317"><span class="linenos">317</span></a><span class="sd">    Retrieve user data by user ID.</span>
</span><span id="get_user_by_id-318"><a href="#get_user_by_id-318"><span class="linenos">318</span></a>
</span><span id="get_user_by_id-319"><a href="#get_user_by_id-319"><span class="linenos">319</span></a><span class="sd">    This function sends a GET request to the server to retrieve user data for the specified user ID.     </span>
</span><span id="get_user_by_id-320"><a href="#get_user_by_id-320"><span class="linenos">320</span></a><span class="sd">    The response data is decrypted using AES before returning the user data.</span>
</span><span id="get_user_by_id-321"><a href="#get_user_by_id-321"><span class="linenos">321</span></a>
</span><span id="get_user_by_id-322"><a href="#get_user_by_id-322"><span class="linenos">322</span></a><span class="sd">    Args:     </span>
</span><span id="get_user_by_id-323"><a href="#get_user_by_id-323"><span class="linenos">323</span></a><span class="sd">        **user_id** (*str*): The unique identifier of the user to retrieve.</span>
</span><span id="get_user_by_id-324"><a href="#get_user_by_id-324"><span class="linenos">324</span></a>
</span><span id="get_user_by_id-325"><a href="#get_user_by_id-325"><span class="linenos">325</span></a><span class="sd">    Returns:     </span>
</span><span id="get_user_by_id-326"><a href="#get_user_by_id-326"><span class="linenos">326</span></a><span class="sd">        *dict*: The user data if the user is found, None otherwise.</span>
</span><span id="get_user_by_id-327"><a href="#get_user_by_id-327"><span class="linenos">327</span></a>
</span><span id="get_user_by_id-328"><a href="#get_user_by_id-328"><span class="linenos">328</span></a><span class="sd">    Example:</span>
</span><span id="get_user_by_id-329"><a href="#get_user_by_id-329"><span class="linenos">329</span></a><span class="sd">    ```</span>
</span><span id="get_user_by_id-330"><a href="#get_user_by_id-330"><span class="linenos">330</span></a><span class="sd">    user_data = get_user_by_id(&quot;1234567890&quot;)</span>
</span><span id="get_user_by_id-331"><a href="#get_user_by_id-331"><span class="linenos">331</span></a><span class="sd">    if user_data:</span>
</span><span id="get_user_by_id-332"><a href="#get_user_by_id-332"><span class="linenos">332</span></a><span class="sd">        print(f&quot;User data: {user_data}&quot;)</span>
</span><span id="get_user_by_id-333"><a href="#get_user_by_id-333"><span class="linenos">333</span></a><span class="sd">    else:</span>
</span><span id="get_user_by_id-334"><a href="#get_user_by_id-334"><span class="linenos">334</span></a><span class="sd">        print(&quot;User not found.&quot;)</span>
</span><span id="get_user_by_id-335"><a href="#get_user_by_id-335"><span class="linenos">335</span></a><span class="sd">    ```</span>
</span><span id="get_user_by_id-336"><a href="#get_user_by_id-336"><span class="linenos">336</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_user_by_id-337"><a href="#get_user_by_id-337"><span class="linenos">337</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/users/</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="get_user_by_id-338"><a href="#get_user_by_id-338"><span class="linenos">338</span></a>
</span><span id="get_user_by_id-339"><a href="#get_user_by_id-339"><span class="linenos">339</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="get_user_by_id-340"><a href="#get_user_by_id-340"><span class="linenos">340</span></a>
</span><span id="get_user_by_id-341"><a href="#get_user_by_id-341"><span class="linenos">341</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="get_user_by_id-342"><a href="#get_user_by_id-342"><span class="linenos">342</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User found.&quot;</span><span class="p">)</span>
</span><span id="get_user_by_id-343"><a href="#get_user_by_id-343"><span class="linenos">343</span></a>        <span class="n">encrypted_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">content</span> 
</span><span id="get_user_by_id-344"><a href="#get_user_by_id-344"><span class="linenos">344</span></a>        <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="get_user_by_id-345"><a href="#get_user_by_id-345"><span class="linenos">345</span></a>        <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="get_user_by_id-346"><a href="#get_user_by_id-346"><span class="linenos">346</span></a>        <span class="n">decrypted_json_string</span> <span class="o">=</span> <span class="n">decrypt_message</span><span class="p">(</span><span class="n">encrypted_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">)</span>
</span><span id="get_user_by_id-347"><a href="#get_user_by_id-347"><span class="linenos">347</span></a>        <span class="n">user_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">decrypted_json_string</span><span class="p">)[</span><span class="s1">&#39;user_data&#39;</span><span class="p">]</span>
</span><span id="get_user_by_id-348"><a href="#get_user_by_id-348"><span class="linenos">348</span></a>        <span class="k">return</span> <span class="n">user_data</span>
</span><span id="get_user_by_id-349"><a href="#get_user_by_id-349"><span class="linenos">349</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_user_by_id-350"><a href="#get_user_by_id-350"><span class="linenos">350</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;User not found:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="get_user_by_id-351"><a href="#get_user_by_id-351"><span class="linenos">351</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve user data by user ID.</p>

<p>This function sends a GET request to the server to retrieve user data for the specified user ID. <br />
The response data is decrypted using AES before returning the user data.</p>

<p>Args: <br />
    <strong>user_id</strong> (<em>str</em>): The unique identifier of the user to retrieve.</p>

<p>Returns: <br />
    <em>dict</em>: The user data if the user is found, None otherwise.</p>

<p>Example:</p>

<pre><code>user_data = get_user_by_id("1234567890")
if user_data:
    print(f"User data: {user_data}")
else:
    print("User not found.")
</code></pre>
</div>


                </section>
                <section id="set_session">
                            <input id="set_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">metadata</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_session-355"><a href="#set_session-355"><span class="linenos">355</span></a><span class="k">def</span> <span class="nf">set_session</span><span class="p">(</span><span class="n">metadata</span><span class="p">):</span>
</span><span id="set_session-356"><a href="#set_session-356"><span class="linenos">356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_session-357"><a href="#set_session-357"><span class="linenos">357</span></a><span class="sd">    Create a new simple session.</span>
</span><span id="set_session-358"><a href="#set_session-358"><span class="linenos">358</span></a>
</span><span id="set_session-359"><a href="#set_session-359"><span class="linenos">359</span></a><span class="sd">    This function sends a POST request to the server to create a new simple session using the provided metadata.</span>
</span><span id="set_session-360"><a href="#set_session-360"><span class="linenos">360</span></a><span class="sd">    The metadata is encrypted using AES before being sent to the server.</span>
</span><span id="set_session-361"><a href="#set_session-361"><span class="linenos">361</span></a>
</span><span id="set_session-362"><a href="#set_session-362"><span class="linenos">362</span></a><span class="sd">    Args:     </span>
</span><span id="set_session-363"><a href="#set_session-363"><span class="linenos">363</span></a><span class="sd">        **metadata** (*dict*): A dictionary containing the session metadata. The only required metadata for the simple session are the user_id and a date.</span>
</span><span id="set_session-364"><a href="#set_session-364"><span class="linenos">364</span></a>
</span><span id="set_session-365"><a href="#set_session-365"><span class="linenos">365</span></a><span class="sd">    Returns:      </span>
</span><span id="set_session-366"><a href="#set_session-366"><span class="linenos">366</span></a><span class="sd">        *str*: The unique identifier of the created session if successful, None otherwise.</span>
</span><span id="set_session-367"><a href="#set_session-367"><span class="linenos">367</span></a>
</span><span id="set_session-368"><a href="#set_session-368"><span class="linenos">368</span></a><span class="sd">    Example:</span>
</span><span id="set_session-369"><a href="#set_session-369"><span class="linenos">369</span></a><span class="sd">    ```</span>
</span><span id="set_session-370"><a href="#set_session-370"><span class="linenos">370</span></a><span class="sd">    session_metadata = {</span>
</span><span id="set_session-371"><a href="#set_session-371"><span class="linenos">371</span></a><span class="sd">        &quot;user_id&quot;: &quot;1076203852085&quot;,</span>
</span><span id="set_session-372"><a href="#set_session-372"><span class="linenos">372</span></a><span class="sd">        &quot;session_date&quot;: &quot;2024-05-30T12:00:00Z&quot;</span>
</span><span id="set_session-373"><a href="#set_session-373"><span class="linenos">373</span></a><span class="sd">    }</span>
</span><span id="set_session-374"><a href="#set_session-374"><span class="linenos">374</span></a><span class="sd">    session_id = set_session(session_metadata)</span>
</span><span id="set_session-375"><a href="#set_session-375"><span class="linenos">375</span></a><span class="sd">    if session_id:</span>
</span><span id="set_session-376"><a href="#set_session-376"><span class="linenos">376</span></a><span class="sd">        print(f&quot;Session created with ID: {session_id}&quot;)</span>
</span><span id="set_session-377"><a href="#set_session-377"><span class="linenos">377</span></a><span class="sd">    else:</span>
</span><span id="set_session-378"><a href="#set_session-378"><span class="linenos">378</span></a><span class="sd">        print(&quot;Failed to create session.&quot;)</span>
</span><span id="set_session-379"><a href="#set_session-379"><span class="linenos">379</span></a><span class="sd">    ```</span>
</span><span id="set_session-380"><a href="#set_session-380"><span class="linenos">380</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_session-381"><a href="#set_session-381"><span class="linenos">381</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions&quot;</span>
</span><span id="set_session-382"><a href="#set_session-382"><span class="linenos">382</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">metadata</span>
</span><span id="set_session-383"><a href="#set_session-383"><span class="linenos">383</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_session</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="set_session-384"><a href="#set_session-384"><span class="linenos">384</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="set_session-385"><a href="#set_session-385"><span class="linenos">385</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="set_session-386"><a href="#set_session-386"><span class="linenos">386</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="set_session-387"><a href="#set_session-387"><span class="linenos">387</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="set_session-388"><a href="#set_session-388"><span class="linenos">388</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_session</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="set_session-389"><a href="#set_session-389"><span class="linenos">389</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="set_session-390"><a href="#set_session-390"><span class="linenos">390</span></a>    <span class="p">)</span>
</span><span id="set_session-391"><a href="#set_session-391"><span class="linenos">391</span></a>
</span><span id="set_session-392"><a href="#set_session-392"><span class="linenos">392</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="set_session-393"><a href="#set_session-393"><span class="linenos">393</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session successfully created.&quot;</span><span class="p">)</span>
</span><span id="set_session-394"><a href="#set_session-394"><span class="linenos">394</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="set_session-395"><a href="#set_session-395"><span class="linenos">395</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</span><span id="set_session-396"><a href="#set_session-396"><span class="linenos">396</span></a>
</span><span id="set_session-397"><a href="#set_session-397"><span class="linenos">397</span></a>        <span class="c1"># print(session_id)</span>
</span><span id="set_session-398"><a href="#set_session-398"><span class="linenos">398</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="set_session-399"><a href="#set_session-399"><span class="linenos">399</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="set_session-400"><a href="#set_session-400"><span class="linenos">400</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="set_session-401"><a href="#set_session-401"><span class="linenos">401</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Create a new simple session.</p>

<p>This function sends a POST request to the server to create a new simple session using the provided metadata.
The metadata is encrypted using AES before being sent to the server.</p>

<p>Args: <br />
    <strong>metadata</strong> (<em>dict</em>): A dictionary containing the session metadata. The only required metadata for the simple session are the user_id and a date.</p>

<p>Returns: <br />
    <em>str</em>: The unique identifier of the created session if successful, None otherwise.</p>

<p>Example:</p>

<pre><code>session_metadata = {
    "user_id": "1076203852085",
    "session_date": "2024-05-30T12:00:00Z"
}
session_id = set_session(session_metadata)
if session_id:
    print(f"Session created with ID: {session_id}")
else:
    print("Failed to create session.")
</code></pre>
</div>


                </section>
                <section id="get_data_by_id">
                            <input id="get_data_by_id-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data_by_id</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_data_by_id-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_data_by_id"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_data_by_id-405"><a href="#get_data_by_id-405"><span class="linenos">405</span></a><span class="k">def</span> <span class="nf">get_data_by_id</span><span class="p">(</span><span class="n">data_id</span><span class="p">):</span>
</span><span id="get_data_by_id-406"><a href="#get_data_by_id-406"><span class="linenos">406</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_data_by_id-407"><a href="#get_data_by_id-407"><span class="linenos">407</span></a><span class="sd">    Retrieve raw data by its unique identifier from the server.</span>
</span><span id="get_data_by_id-408"><a href="#get_data_by_id-408"><span class="linenos">408</span></a>
</span><span id="get_data_by_id-409"><a href="#get_data_by_id-409"><span class="linenos">409</span></a><span class="sd">    This function sends a GET request to fetch raw data associated with a specific identifier. It</span>
</span><span id="get_data_by_id-410"><a href="#get_data_by_id-410"><span class="linenos">410</span></a><span class="sd">    assumes that the data, if retrieved successfully, does not require decryption and is directly accessible.</span>
</span><span id="get_data_by_id-411"><a href="#get_data_by_id-411"><span class="linenos">411</span></a>
</span><span id="get_data_by_id-412"><a href="#get_data_by_id-412"><span class="linenos">412</span></a><span class="sd">    Args:      </span>
</span><span id="get_data_by_id-413"><a href="#get_data_by_id-413"><span class="linenos">413</span></a><span class="sd">        **data_id** (*str*): The unique identifier for the data to be retrieved.</span>
</span><span id="get_data_by_id-414"><a href="#get_data_by_id-414"><span class="linenos">414</span></a>
</span><span id="get_data_by_id-415"><a href="#get_data_by_id-415"><span class="linenos">415</span></a><span class="sd">    Returns:       </span>
</span><span id="get_data_by_id-416"><a href="#get_data_by_id-416"><span class="linenos">416</span></a><span class="sd">        **dict**: The raw data if retrieval is successful, None otherwise.</span>
</span><span id="get_data_by_id-417"><a href="#get_data_by_id-417"><span class="linenos">417</span></a>
</span><span id="get_data_by_id-418"><a href="#get_data_by_id-418"><span class="linenos">418</span></a><span class="sd">    Example:</span>
</span><span id="get_data_by_id-419"><a href="#get_data_by_id-419"><span class="linenos">419</span></a><span class="sd">    ```</span>
</span><span id="get_data_by_id-420"><a href="#get_data_by_id-420"><span class="linenos">420</span></a><span class="sd">    data_id = &quot;1234&quot;</span>
</span><span id="get_data_by_id-421"><a href="#get_data_by_id-421"><span class="linenos">421</span></a><span class="sd">    raw_data = get_data_by_id(data_id)</span>
</span><span id="get_data_by_id-422"><a href="#get_data_by_id-422"><span class="linenos">422</span></a><span class="sd">    ... use the data</span>
</span><span id="get_data_by_id-423"><a href="#get_data_by_id-423"><span class="linenos">423</span></a><span class="sd">    ```</span>
</span><span id="get_data_by_id-424"><a href="#get_data_by_id-424"><span class="linenos">424</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_data_by_id-425"><a href="#get_data_by_id-425"><span class="linenos">425</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/rawdata/</span><span class="si">{</span><span class="n">data_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="get_data_by_id-426"><a href="#get_data_by_id-426"><span class="linenos">426</span></a>    
</span><span id="get_data_by_id-427"><a href="#get_data_by_id-427"><span class="linenos">427</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="get_data_by_id-428"><a href="#get_data_by_id-428"><span class="linenos">428</span></a>    
</span><span id="get_data_by_id-429"><a href="#get_data_by_id-429"><span class="linenos">429</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="get_data_by_id-430"><a href="#get_data_by_id-430"><span class="linenos">430</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved data successfully.&quot;</span><span class="p">)</span>
</span><span id="get_data_by_id-431"><a href="#get_data_by_id-431"><span class="linenos">431</span></a>        <span class="c1"># decrypt</span>
</span><span id="get_data_by_id-432"><a href="#get_data_by_id-432"><span class="linenos">432</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rawData&#39;</span><span class="p">)</span>
</span><span id="get_data_by_id-433"><a href="#get_data_by_id-433"><span class="linenos">433</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_data_by_id-434"><a href="#get_data_by_id-434"><span class="linenos">434</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve data:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve raw data by its unique identifier from the server.</p>

<p>This function sends a GET request to fetch raw data associated with a specific identifier. It
assumes that the data, if retrieved successfully, does not require decryption and is directly accessible.</p>

<p>Args: <br />
    <strong>data_id</strong> (<em>str</em>): The unique identifier for the data to be retrieved.</p>

<p>Returns: <br />
    <strong>dict</strong>: The raw data if retrieval is successful, None otherwise.</p>

<p>Example:</p>

<pre><code>data_id = "1234"
raw_data = get_data_by_id(data_id)
... use the data
</code></pre>
</div>


                </section>
                <section id="get_data_by_session">
                            <input id="get_data_by_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data_by_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">session_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_data_by_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_data_by_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_data_by_session-438"><a href="#get_data_by_session-438"><span class="linenos">438</span></a><span class="k">def</span> <span class="nf">get_data_by_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">):</span>
</span><span id="get_data_by_session-439"><a href="#get_data_by_session-439"><span class="linenos">439</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_data_by_session-440"><a href="#get_data_by_session-440"><span class="linenos">440</span></a><span class="sd">    Retrieve raw data associated with a specific session identifier from the server.</span>
</span><span id="get_data_by_session-441"><a href="#get_data_by_session-441"><span class="linenos">441</span></a>
</span><span id="get_data_by_session-442"><a href="#get_data_by_session-442"><span class="linenos">442</span></a><span class="sd">    This function sends a GET request to fetch all raw data linked to the given session ID. The data</span>
</span><span id="get_data_by_session-443"><a href="#get_data_by_session-443"><span class="linenos">443</span></a><span class="sd">    is returned in its raw form assuming it does not require decryption for usage.</span>
</span><span id="get_data_by_session-444"><a href="#get_data_by_session-444"><span class="linenos">444</span></a>
</span><span id="get_data_by_session-445"><a href="#get_data_by_session-445"><span class="linenos">445</span></a><span class="sd">    Args:      </span>
</span><span id="get_data_by_session-446"><a href="#get_data_by_session-446"><span class="linenos">446</span></a><span class="sd">        **session_id** (*str*): The session identifier whose associated data is to be retrieved.</span>
</span><span id="get_data_by_session-447"><a href="#get_data_by_session-447"><span class="linenos">447</span></a>
</span><span id="get_data_by_session-448"><a href="#get_data_by_session-448"><span class="linenos">448</span></a><span class="sd">    Returns:       </span>
</span><span id="get_data_by_session-449"><a href="#get_data_by_session-449"><span class="linenos">449</span></a><span class="sd">        *dict*: The raw data linked to the session if retrieval is successful, None otherwise.</span>
</span><span id="get_data_by_session-450"><a href="#get_data_by_session-450"><span class="linenos">450</span></a>
</span><span id="get_data_by_session-451"><a href="#get_data_by_session-451"><span class="linenos">451</span></a><span class="sd">    Example:</span>
</span><span id="get_data_by_session-452"><a href="#get_data_by_session-452"><span class="linenos">452</span></a><span class="sd">    ```</span>
</span><span id="get_data_by_session-453"><a href="#get_data_by_session-453"><span class="linenos">453</span></a><span class="sd">    session_id = &quot;abcd1234&quot;</span>
</span><span id="get_data_by_session-454"><a href="#get_data_by_session-454"><span class="linenos">454</span></a><span class="sd">    session_data = get_data_by_session(session_id)</span>
</span><span id="get_data_by_session-455"><a href="#get_data_by_session-455"><span class="linenos">455</span></a><span class="sd">    if session_data:</span>
</span><span id="get_data_by_session-456"><a href="#get_data_by_session-456"><span class="linenos">456</span></a><span class="sd">        print(&quot;Data retrieved:&quot;, session_data)</span>
</span><span id="get_data_by_session-457"><a href="#get_data_by_session-457"><span class="linenos">457</span></a><span class="sd">    else:</span>
</span><span id="get_data_by_session-458"><a href="#get_data_by_session-458"><span class="linenos">458</span></a><span class="sd">        print(&quot;Failed to retrieve data.&quot;)</span>
</span><span id="get_data_by_session-459"><a href="#get_data_by_session-459"><span class="linenos">459</span></a><span class="sd">    ```</span>
</span><span id="get_data_by_session-460"><a href="#get_data_by_session-460"><span class="linenos">460</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_data_by_session-461"><a href="#get_data_by_session-461"><span class="linenos">461</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">/rawdata&quot;</span>
</span><span id="get_data_by_session-462"><a href="#get_data_by_session-462"><span class="linenos">462</span></a>    
</span><span id="get_data_by_session-463"><a href="#get_data_by_session-463"><span class="linenos">463</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="get_data_by_session-464"><a href="#get_data_by_session-464"><span class="linenos">464</span></a>    
</span><span id="get_data_by_session-465"><a href="#get_data_by_session-465"><span class="linenos">465</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="get_data_by_session-466"><a href="#get_data_by_session-466"><span class="linenos">466</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved data successfully.&quot;</span><span class="p">)</span>
</span><span id="get_data_by_session-467"><a href="#get_data_by_session-467"><span class="linenos">467</span></a>        <span class="c1"># decrypt</span>
</span><span id="get_data_by_session-468"><a href="#get_data_by_session-468"><span class="linenos">468</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</span><span id="get_data_by_session-469"><a href="#get_data_by_session-469"><span class="linenos">469</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_data_by_session-470"><a href="#get_data_by_session-470"><span class="linenos">470</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve data:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve raw data associated with a specific session identifier from the server.</p>

<p>This function sends a GET request to fetch all raw data linked to the given session ID. The data
is returned in its raw form assuming it does not require decryption for usage.</p>

<p>Args: <br />
    <strong>session_id</strong> (<em>str</em>): The session identifier whose associated data is to be retrieved.</p>

<p>Returns: <br />
    <em>dict</em>: The raw data linked to the session if retrieval is successful, None otherwise.</p>

<p>Example:</p>

<pre><code>session_id = "abcd1234"
session_data = get_data_by_session(session_id)
if session_data:
    print("Data retrieved:", session_data)
else:
    print("Failed to retrieve data.")
</code></pre>
</div>


                </section>
                <section id="get_data_ids_by_session">
                            <input id="get_data_ids_by_session-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_data_ids_by_session</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">session_id</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_data_ids_by_session-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_data_ids_by_session"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_data_ids_by_session-475"><a href="#get_data_ids_by_session-475"><span class="linenos">475</span></a><span class="k">def</span> <span class="nf">get_data_ids_by_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">):</span>
</span><span id="get_data_ids_by_session-476"><a href="#get_data_ids_by_session-476"><span class="linenos">476</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="get_data_ids_by_session-477"><a href="#get_data_ids_by_session-477"><span class="linenos">477</span></a><span class="sd">    Retrieve a list of data IDs associated with a specific session from the server.</span>
</span><span id="get_data_ids_by_session-478"><a href="#get_data_ids_by_session-478"><span class="linenos">478</span></a>
</span><span id="get_data_ids_by_session-479"><a href="#get_data_ids_by_session-479"><span class="linenos">479</span></a><span class="sd">    This function sends a GET request to fetch the IDs of all data entries linked to a specified session ID.</span>
</span><span id="get_data_ids_by_session-480"><a href="#get_data_ids_by_session-480"><span class="linenos">480</span></a><span class="sd">    The IDs are returned as a list. The function assumes the data does not require decryption for usage.</span>
</span><span id="get_data_ids_by_session-481"><a href="#get_data_ids_by_session-481"><span class="linenos">481</span></a>
</span><span id="get_data_ids_by_session-482"><a href="#get_data_ids_by_session-482"><span class="linenos">482</span></a><span class="sd">    Args:      </span>
</span><span id="get_data_ids_by_session-483"><a href="#get_data_ids_by_session-483"><span class="linenos">483</span></a><span class="sd">        **session_id** (*str*): The session identifier for which data IDs are to be retrieved.</span>
</span><span id="get_data_ids_by_session-484"><a href="#get_data_ids_by_session-484"><span class="linenos">484</span></a>
</span><span id="get_data_ids_by_session-485"><a href="#get_data_ids_by_session-485"><span class="linenos">485</span></a><span class="sd">    Returns:       </span>
</span><span id="get_data_ids_by_session-486"><a href="#get_data_ids_by_session-486"><span class="linenos">486</span></a><span class="sd">        *list*: A list of data IDs if retrieval is successful, None otherwise.</span>
</span><span id="get_data_ids_by_session-487"><a href="#get_data_ids_by_session-487"><span class="linenos">487</span></a>
</span><span id="get_data_ids_by_session-488"><a href="#get_data_ids_by_session-488"><span class="linenos">488</span></a><span class="sd">    Example:</span>
</span><span id="get_data_ids_by_session-489"><a href="#get_data_ids_by_session-489"><span class="linenos">489</span></a><span class="sd">    ```</span>
</span><span id="get_data_ids_by_session-490"><a href="#get_data_ids_by_session-490"><span class="linenos">490</span></a><span class="sd">    session_id = &quot;abcd1234&quot;</span>
</span><span id="get_data_ids_by_session-491"><a href="#get_data_ids_by_session-491"><span class="linenos">491</span></a><span class="sd">    data_ids = get_data_ids_by_session(session_id)</span>
</span><span id="get_data_ids_by_session-492"><a href="#get_data_ids_by_session-492"><span class="linenos">492</span></a><span class="sd">    if data_ids:</span>
</span><span id="get_data_ids_by_session-493"><a href="#get_data_ids_by_session-493"><span class="linenos">493</span></a><span class="sd">        print(&quot;Data IDs retrieved:&quot;, data_ids)</span>
</span><span id="get_data_ids_by_session-494"><a href="#get_data_ids_by_session-494"><span class="linenos">494</span></a><span class="sd">    else:</span>
</span><span id="get_data_ids_by_session-495"><a href="#get_data_ids_by_session-495"><span class="linenos">495</span></a><span class="sd">        print(&quot;Failed to retrieve data IDs.&quot;)</span>
</span><span id="get_data_ids_by_session-496"><a href="#get_data_ids_by_session-496"><span class="linenos">496</span></a><span class="sd">    ```</span>
</span><span id="get_data_ids_by_session-497"><a href="#get_data_ids_by_session-497"><span class="linenos">497</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="get_data_ids_by_session-498"><a href="#get_data_ids_by_session-498"><span class="linenos">498</span></a>    <span class="n">get_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">/ids&quot;</span>
</span><span id="get_data_ids_by_session-499"><a href="#get_data_ids_by_session-499"><span class="linenos">499</span></a>    
</span><span id="get_data_ids_by_session-500"><a href="#get_data_ids_by_session-500"><span class="linenos">500</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">get_url</span><span class="p">)</span>
</span><span id="get_data_ids_by_session-501"><a href="#get_data_ids_by_session-501"><span class="linenos">501</span></a>    
</span><span id="get_data_ids_by_session-502"><a href="#get_data_ids_by_session-502"><span class="linenos">502</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="get_data_ids_by_session-503"><a href="#get_data_ids_by_session-503"><span class="linenos">503</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Retrieved ids successfully.&quot;</span><span class="p">)</span>
</span><span id="get_data_ids_by_session-504"><a href="#get_data_ids_by_session-504"><span class="linenos">504</span></a>        <span class="c1"># decrypt</span>
</span><span id="get_data_ids_by_session-505"><a href="#get_data_ids_by_session-505"><span class="linenos">505</span></a>        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ids&#39;</span><span class="p">)</span>
</span><span id="get_data_ids_by_session-506"><a href="#get_data_ids_by_session-506"><span class="linenos">506</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="get_data_ids_by_session-507"><a href="#get_data_ids_by_session-507"><span class="linenos">507</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve ids:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Retrieve a list of data IDs associated with a specific session from the server.</p>

<p>This function sends a GET request to fetch the IDs of all data entries linked to a specified session ID.
The IDs are returned as a list. The function assumes the data does not require decryption for usage.</p>

<p>Args: <br />
    <strong>session_id</strong> (<em>str</em>): The session identifier for which data IDs are to be retrieved.</p>

<p>Returns: <br />
    <em>list</em>: A list of data IDs if retrieval is successful, None otherwise.</p>

<p>Example:</p>

<pre><code>session_id = "abcd1234"
data_ids = get_data_ids_by_session(session_id)
if data_ids:
    print("Data IDs retrieved:", data_ids)
else:
    print("Failed to retrieve data IDs.")
</code></pre>
</div>


                </section>
                <section id="upload_data">
                            <input id="upload_data-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">upload_data</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">metadata</span>, </span><span class="param"><span class="n">timestamps</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">ppg_red</span>, </span><span class="param"><span class="n">ppg_ir</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="upload_data-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#upload_data"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="upload_data-512"><a href="#upload_data-512"><span class="linenos">512</span></a><span class="k">def</span> <span class="nf">upload_data</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ppg_red</span><span class="p">,</span> <span class="n">ppg_ir</span><span class="p">):</span>
</span><span id="upload_data-513"><a href="#upload_data-513"><span class="linenos">513</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="upload_data-514"><a href="#upload_data-514"><span class="linenos">514</span></a><span class="sd">    Uploads EEG and PPG data to the server along with associated metadata.</span>
</span><span id="upload_data-515"><a href="#upload_data-515"><span class="linenos">515</span></a>
</span><span id="upload_data-516"><a href="#upload_data-516"><span class="linenos">516</span></a><span class="sd">    This function compiles different types of physiological data along with metadata into a single dictionary,</span>
</span><span id="upload_data-517"><a href="#upload_data-517"><span class="linenos">517</span></a><span class="sd">    encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a</span>
</span><span id="upload_data-518"><a href="#upload_data-518"><span class="linenos">518</span></a><span class="sd">    unique identifier for the data which can then be used for future queries or operations.</span>
</span><span id="upload_data-519"><a href="#upload_data-519"><span class="linenos">519</span></a>
</span><span id="upload_data-520"><a href="#upload_data-520"><span class="linenos">520</span></a><span class="sd">    Args:     </span>
</span><span id="upload_data-521"><a href="#upload_data-521"><span class="linenos">521</span></a><span class="sd">    **metadata** (*dict*): Information about the data such as subject details and session parameters.     </span>
</span><span id="upload_data-522"><a href="#upload_data-522"><span class="linenos">522</span></a><span class="sd">    **timestamps** (*list*): List of timestamps correlating with each data point.     </span>
</span><span id="upload_data-523"><a href="#upload_data-523"><span class="linenos">523</span></a><span class="sd">    **data** (*list*): EEG data points.     </span>
</span><span id="upload_data-524"><a href="#upload_data-524"><span class="linenos">524</span></a><span class="sd">    **ppg_red** (*list*): Red photoplethysmogram data points.     </span>
</span><span id="upload_data-525"><a href="#upload_data-525"><span class="linenos">525</span></a><span class="sd">    **ppg_ir** (*list*): Infrared photoplethysmogram data points.      </span>
</span><span id="upload_data-526"><a href="#upload_data-526"><span class="linenos">526</span></a>
</span><span id="upload_data-527"><a href="#upload_data-527"><span class="linenos">527</span></a><span class="sd">    Returns:     </span>
</span><span id="upload_data-528"><a href="#upload_data-528"><span class="linenos">528</span></a><span class="sd">    *tuple*: A tuple containing the data ID of the uploaded data if successful, and None otherwise.</span>
</span><span id="upload_data-529"><a href="#upload_data-529"><span class="linenos">529</span></a>
</span><span id="upload_data-530"><a href="#upload_data-530"><span class="linenos">530</span></a><span class="sd">    Example:</span>
</span><span id="upload_data-531"><a href="#upload_data-531"><span class="linenos">531</span></a><span class="sd">    ```</span>
</span><span id="upload_data-532"><a href="#upload_data-532"><span class="linenos">532</span></a><span class="sd">    metadata = {&quot;session_id&quot;: &quot;1234&quot;, &quot;subject_id&quot;: &quot;001&quot;}</span>
</span><span id="upload_data-533"><a href="#upload_data-533"><span class="linenos">533</span></a><span class="sd">    timestamps = [1597709184, 1597709185]</span>
</span><span id="upload_data-534"><a href="#upload_data-534"><span class="linenos">534</span></a><span class="sd">    data = [0.1, 0.2]</span>
</span><span id="upload_data-535"><a href="#upload_data-535"><span class="linenos">535</span></a><span class="sd">    ppg_red = [123, 124]</span>
</span><span id="upload_data-536"><a href="#upload_data-536"><span class="linenos">536</span></a><span class="sd">    ppg_ir = [125, 126]</span>
</span><span id="upload_data-537"><a href="#upload_data-537"><span class="linenos">537</span></a><span class="sd">    data_id, error = upload_data(metadata, timestamps, data, ppg_red, ppg_ir)</span>
</span><span id="upload_data-538"><a href="#upload_data-538"><span class="linenos">538</span></a><span class="sd">    if data_id:</span>
</span><span id="upload_data-539"><a href="#upload_data-539"><span class="linenos">539</span></a><span class="sd">        print(&quot;Data uploaded successfully. Data ID:&quot;, data_id)</span>
</span><span id="upload_data-540"><a href="#upload_data-540"><span class="linenos">540</span></a><span class="sd">    else:</span>
</span><span id="upload_data-541"><a href="#upload_data-541"><span class="linenos">541</span></a><span class="sd">        print(&quot;Upload failed with error:&quot;, error)</span>
</span><span id="upload_data-542"><a href="#upload_data-542"><span class="linenos">542</span></a><span class="sd">    ```</span>
</span><span id="upload_data-543"><a href="#upload_data-543"><span class="linenos">543</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="upload_data-544"><a href="#upload_data-544"><span class="linenos">544</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/rawdata&quot;</span>
</span><span id="upload_data-545"><a href="#upload_data-545"><span class="linenos">545</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="upload_data-546"><a href="#upload_data-546"><span class="linenos">546</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="upload_data-547"><a href="#upload_data-547"><span class="linenos">547</span></a>        <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
</span><span id="upload_data-548"><a href="#upload_data-548"><span class="linenos">548</span></a>        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="upload_data-549"><a href="#upload_data-549"><span class="linenos">549</span></a>        <span class="s2">&quot;ppg_red&quot;</span><span class="p">:</span> <span class="n">ppg_red</span><span class="p">,</span>
</span><span id="upload_data-550"><a href="#upload_data-550"><span class="linenos">550</span></a>        <span class="s2">&quot;ppg_ir&quot;</span><span class="p">:</span> <span class="n">ppg_ir</span>
</span><span id="upload_data-551"><a href="#upload_data-551"><span class="linenos">551</span></a>    <span class="p">}</span>
</span><span id="upload_data-552"><a href="#upload_data-552"><span class="linenos">552</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="upload_data-553"><a href="#upload_data-553"><span class="linenos">553</span></a>
</span><span id="upload_data-554"><a href="#upload_data-554"><span class="linenos">554</span></a>    <span class="c1"># response = requests.post(url, json=_data)</span>
</span><span id="upload_data-555"><a href="#upload_data-555"><span class="linenos">555</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="upload_data-556"><a href="#upload_data-556"><span class="linenos">556</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="upload_data-557"><a href="#upload_data-557"><span class="linenos">557</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="upload_data-558"><a href="#upload_data-558"><span class="linenos">558</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="upload_data-559"><a href="#upload_data-559"><span class="linenos">559</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="upload_data-560"><a href="#upload_data-560"><span class="linenos">560</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="upload_data-561"><a href="#upload_data-561"><span class="linenos">561</span></a>    <span class="p">)</span>
</span><span id="upload_data-562"><a href="#upload_data-562"><span class="linenos">562</span></a>
</span><span id="upload_data-563"><a href="#upload_data-563"><span class="linenos">563</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="upload_data-564"><a href="#upload_data-564"><span class="linenos">564</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="upload_data-565"><a href="#upload_data-565"><span class="linenos">565</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="upload_data-566"><a href="#upload_data-566"><span class="linenos">566</span></a>        <span class="n">data_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_id&#39;</span><span class="p">)</span>
</span><span id="upload_data-567"><a href="#upload_data-567"><span class="linenos">567</span></a>        <span class="k">return</span> <span class="n">data_id</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="upload_data-568"><a href="#upload_data-568"><span class="linenos">568</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="upload_data-569"><a href="#upload_data-569"><span class="linenos">569</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upload failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="upload_data-570"><a href="#upload_data-570"><span class="linenos">570</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Uploads EEG and PPG data to the server along with associated metadata.</p>

<p>This function compiles different types of physiological data along with metadata into a single dictionary,
encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a
unique identifier for the data which can then be used for future queries or operations.</p>

<p>Args: <br />
<strong>metadata</strong> (<em>dict</em>): Information about the data such as subject details and session parameters. <br />
<strong>timestamps</strong> (<em>list</em>): List of timestamps correlating with each data point. <br />
<strong>data</strong> (<em>list</em>): EEG data points. <br />
<strong>ppg_red</strong> (<em>list</em>): Red photoplethysmogram data points. <br />
<strong>ppg_ir</strong> (<em>list</em>): Infrared photoplethysmogram data points.      </p>

<p>Returns: <br />
<em>tuple</em>: A tuple containing the data ID of the uploaded data if successful, and None otherwise.</p>

<p>Example:</p>

<pre><code>metadata = {"session_id": "1234", "subject_id": "001"}
timestamps = [1597709184, 1597709185]
data = [0.1, 0.2]
ppg_red = [123, 124]
ppg_ir = [125, 126]
data_id, error = upload_data(metadata, timestamps, data, ppg_red, ppg_ir)
if data_id:
    print("Data uploaded successfully. Data ID:", data_id)
else:
    print("Upload failed with error:", error)
</code></pre>
</div>


                </section>
                <section id="acquire_send_raw">
                            <input id="acquire_send_raw-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acquire_send_raw</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span>, </span><span class="param"><span class="n">date</span>, </span><span class="param"><span class="n">board</span>, </span><span class="param"><span class="n">stream_duration</span>, </span><span class="param"><span class="n">buffer_duration</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acquire_send_raw-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acquire_send_raw"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acquire_send_raw-575"><a href="#acquire_send_raw-575"><span class="linenos">575</span></a><span class="k">def</span> <span class="nf">acquire_send_raw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">):</span>
</span><span id="acquire_send_raw-576"><a href="#acquire_send_raw-576"><span class="linenos">576</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="acquire_send_raw-577"><a href="#acquire_send_raw-577"><span class="linenos">577</span></a><span class="sd">    Asynchronously acquires raw data from a specific EEG board and sends it to the server.</span>
</span><span id="acquire_send_raw-578"><a href="#acquire_send_raw-578"><span class="linenos">578</span></a>
</span><span id="acquire_send_raw-579"><a href="#acquire_send_raw-579"><span class="linenos">579</span></a><span class="sd">    This function connects to an EEG board, initiates a data acquisition session, and sends the collected data</span>
</span><span id="acquire_send_raw-580"><a href="#acquire_send_raw-580"><span class="linenos">580</span></a><span class="sd">    to the server in real-time or near real-time. It ensures that all the data handled during the session</span>
</span><span id="acquire_send_raw-581"><a href="#acquire_send_raw-581"><span class="linenos">581</span></a><span class="sd">    is associated with a unique session ID and metadata that includes user and session details. The function</span>
</span><span id="acquire_send_raw-582"><a href="#acquire_send_raw-582"><span class="linenos">582</span></a><span class="sd">    will validate the session metadata before proceeding with data acquisition and sending.</span>
</span><span id="acquire_send_raw-583"><a href="#acquire_send_raw-583"><span class="linenos">583</span></a>
</span><span id="acquire_send_raw-584"><a href="#acquire_send_raw-584"><span class="linenos">584</span></a><span class="sd">    Args:      </span>
</span><span id="acquire_send_raw-585"><a href="#acquire_send_raw-585"><span class="linenos">585</span></a><span class="sd">    **user_id** (*str*): The unique identifier of the user for whom the data is being collected.      </span>
</span><span id="acquire_send_raw-586"><a href="#acquire_send_raw-586"><span class="linenos">586</span></a><span class="sd">    **date** (*str*): The date of the session, used for metadata purposes.     </span>
</span><span id="acquire_send_raw-587"><a href="#acquire_send_raw-587"><span class="linenos">587</span></a><span class="sd">    **board** (*int*): Identifier for the EEG board from which data will be acquired.      </span>
</span><span id="acquire_send_raw-588"><a href="#acquire_send_raw-588"><span class="linenos">588</span></a><span class="sd">    **stream_duration** (*int*): Duration in seconds for which data will be streamed from the board.     </span>
</span><span id="acquire_send_raw-589"><a href="#acquire_send_raw-589"><span class="linenos">589</span></a><span class="sd">    **buffer_duration** (*int*): Time in seconds for how often the data is buffered and sent.     </span>
</span><span id="acquire_send_raw-590"><a href="#acquire_send_raw-590"><span class="linenos">590</span></a>
</span><span id="acquire_send_raw-591"><a href="#acquire_send_raw-591"><span class="linenos">591</span></a><span class="sd">    Returns:     </span>
</span><span id="acquire_send_raw-592"><a href="#acquire_send_raw-592"><span class="linenos">592</span></a><span class="sd">    *str* or *bool*: The session ID if the operation is successful; False otherwise.</span>
</span><span id="acquire_send_raw-593"><a href="#acquire_send_raw-593"><span class="linenos">593</span></a>
</span><span id="acquire_send_raw-594"><a href="#acquire_send_raw-594"><span class="linenos">594</span></a><span class="sd">    Raises:</span>
</span><span id="acquire_send_raw-595"><a href="#acquire_send_raw-595"><span class="linenos">595</span></a><span class="sd">    **ConnectionError**: If the board connection fails.      </span>
</span><span id="acquire_send_raw-596"><a href="#acquire_send_raw-596"><span class="linenos">596</span></a><span class="sd">    **ValidationError**: If the metadata does not comply with the required schema.</span>
</span><span id="acquire_send_raw-597"><a href="#acquire_send_raw-597"><span class="linenos">597</span></a>
</span><span id="acquire_send_raw-598"><a href="#acquire_send_raw-598"><span class="linenos">598</span></a><span class="sd">    Example:</span>
</span><span id="acquire_send_raw-599"><a href="#acquire_send_raw-599"><span class="linenos">599</span></a><span class="sd">    ```</span>
</span><span id="acquire_send_raw-600"><a href="#acquire_send_raw-600"><span class="linenos">600</span></a><span class="sd">    session = acquire_send_raw(&#39;user123&#39;, &#39;2021-06-01&#39;, &#39;MUSE_S&#39;, 300, 10)</span>
</span><span id="acquire_send_raw-601"><a href="#acquire_send_raw-601"><span class="linenos">601</span></a><span class="sd">    if session:</span>
</span><span id="acquire_send_raw-602"><a href="#acquire_send_raw-602"><span class="linenos">602</span></a><span class="sd">        print(f&quot;Session successfully started with ID: {session}&quot;)</span>
</span><span id="acquire_send_raw-603"><a href="#acquire_send_raw-603"><span class="linenos">603</span></a><span class="sd">    else:</span>
</span><span id="acquire_send_raw-604"><a href="#acquire_send_raw-604"><span class="linenos">604</span></a><span class="sd">        print(&quot;Failed to start session&quot;)</span>
</span><span id="acquire_send_raw-605"><a href="#acquire_send_raw-605"><span class="linenos">605</span></a><span class="sd">    ```</span>
</span><span id="acquire_send_raw-606"><a href="#acquire_send_raw-606"><span class="linenos">606</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acquire_send_raw-607"><a href="#acquire_send_raw-607"><span class="linenos">607</span></a>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> <span class="n">_acquire_send_raw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">)</span> <span class="p">)</span>
</span><span id="acquire_send_raw-608"><a href="#acquire_send_raw-608"><span class="linenos">608</span></a>    <span class="k">return</span> <span class="n">session_id</span>
</span></pre></div>


            <div class="docstring"><p>Asynchronously acquires raw data from a specific EEG board and sends it to the server.</p>

<p>This function connects to an EEG board, initiates a data acquisition session, and sends the collected data
to the server in real-time or near real-time. It ensures that all the data handled during the session
is associated with a unique session ID and metadata that includes user and session details. The function
will validate the session metadata before proceeding with data acquisition and sending.</p>

<p>Args: <br />
<strong>user_id</strong> (<em>str</em>): The unique identifier of the user for whom the data is being collected. <br />
<strong>date</strong> (<em>str</em>): The date of the session, used for metadata purposes. <br />
<strong>board</strong> (<em>int</em>): Identifier for the EEG board from which data will be acquired. <br />
<strong>stream_duration</strong> (<em>int</em>): Duration in seconds for which data will be streamed from the board. <br />
<strong>buffer_duration</strong> (<em>int</em>): Time in seconds for how often the data is buffered and sent.     </p>

<p>Returns: <br />
<em>str</em> or <em>bool</em>: The session ID if the operation is successful; False otherwise.</p>

<p>Raises:
<strong>ConnectionError</strong>: If the board connection fails. <br />
<strong>ValidationError</strong>: If the metadata does not comply with the required schema.</p>

<p>Example:</p>

<pre><code>session = acquire_send_raw('user123', '2021-06-01', 'MUSE_S', 300, 10)
if session:
    print(f"Session successfully started with ID: {session}")
else:
    print("Failed to start session")
</code></pre>
</div>


                </section>
                <section id="send_file">
                            <input id="send_file-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">send_file</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">user_id</span>, </span><span class="param"><span class="n">date</span>, </span><span class="param"><span class="n">edf_file</span>, </span><span class="param"><span class="n">ch_nrs</span><span class="o">=</span><span class="kc">None</span>, </span><span class="param"><span class="n">ch_names</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="send_file-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#send_file"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="send_file-638"><a href="#send_file-638"><span class="linenos">638</span></a><span class="k">def</span> <span class="nf">send_file</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">edf_file</span><span class="p">,</span> <span class="n">ch_nrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ch_names</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="send_file-639"><a href="#send_file-639"><span class="linenos">639</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="send_file-640"><a href="#send_file-640"><span class="linenos">640</span></a><span class="sd">    Uploads EEG data from a file to the server along with associated metadata.</span>
</span><span id="send_file-641"><a href="#send_file-641"><span class="linenos">641</span></a>
</span><span id="send_file-642"><a href="#send_file-642"><span class="linenos">642</span></a><span class="sd">    This function compiles EEG data from an [EDF file](https://www.edfplus.info/downloads/index.html) along with metadata into a single dictionary,</span>
</span><span id="send_file-643"><a href="#send_file-643"><span class="linenos">643</span></a><span class="sd">    encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a</span>
</span><span id="send_file-644"><a href="#send_file-644"><span class="linenos">644</span></a><span class="sd">    unique identifier for the session which can then be used for future queries or operations.</span>
</span><span id="send_file-645"><a href="#send_file-645"><span class="linenos">645</span></a>
</span><span id="send_file-646"><a href="#send_file-646"><span class="linenos">646</span></a><span class="sd">    Args:    </span>
</span><span id="send_file-647"><a href="#send_file-647"><span class="linenos">647</span></a><span class="sd">    **user_id** (*str*): The unique identifier of the user for whom the data is being collected.     </span>
</span><span id="send_file-648"><a href="#send_file-648"><span class="linenos">648</span></a><span class="sd">    **metadata** (*dict*): Information about the data such as subject details and session parameters.     </span>
</span><span id="send_file-649"><a href="#send_file-649"><span class="linenos">649</span></a><span class="sd">    **date** (*str*): The date of the session, used for metadata purposes.     </span>
</span><span id="send_file-650"><a href="#send_file-650"><span class="linenos">650</span></a><span class="sd">    **edf_file** (*str*): name of an EDF file.      </span>
</span><span id="send_file-651"><a href="#send_file-651"><span class="linenos">651</span></a><span class="sd">    **ch_nrs** (*list of int*, optional): The indices of the channels to read. The default is None.     </span>
</span><span id="send_file-652"><a href="#send_file-652"><span class="linenos">652</span></a><span class="sd">    **ch_names** (*list of str*, optional): The names of channels to read. The default is None.     </span>
</span><span id="send_file-653"><a href="#send_file-653"><span class="linenos">653</span></a>
</span><span id="send_file-654"><a href="#send_file-654"><span class="linenos">654</span></a><span class="sd">    Returns:     </span>
</span><span id="send_file-655"><a href="#send_file-655"><span class="linenos">655</span></a><span class="sd">        *tuple*: A tuple containing the session ID of the uploaded data if successful, and None otherwise.</span>
</span><span id="send_file-656"><a href="#send_file-656"><span class="linenos">656</span></a>
</span><span id="send_file-657"><a href="#send_file-657"><span class="linenos">657</span></a><span class="sd">    Example:</span>
</span><span id="send_file-658"><a href="#send_file-658"><span class="linenos">658</span></a><span class="sd">    ```</span>
</span><span id="send_file-659"><a href="#send_file-659"><span class="linenos">659</span></a><span class="sd">    session = send_file(&#39;user123&#39;, &#39;2021-06-01&#39;, &#39;nameoffile.edf&#39;)</span>
</span><span id="send_file-660"><a href="#send_file-660"><span class="linenos">660</span></a><span class="sd">    if session:</span>
</span><span id="send_file-661"><a href="#send_file-661"><span class="linenos">661</span></a><span class="sd">        print(f&quot;Session successfully started with ID: {session}&quot;)</span>
</span><span id="send_file-662"><a href="#send_file-662"><span class="linenos">662</span></a><span class="sd">    else:</span>
</span><span id="send_file-663"><a href="#send_file-663"><span class="linenos">663</span></a><span class="sd">        print(&quot;Failed to start session&quot;)</span>
</span><span id="send_file-664"><a href="#send_file-664"><span class="linenos">664</span></a><span class="sd">    ```</span>
</span><span id="send_file-665"><a href="#send_file-665"><span class="linenos">665</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="send_file-666"><a href="#send_file-666"><span class="linenos">666</span></a>
</span><span id="send_file-667"><a href="#send_file-667"><span class="linenos">667</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="send_file-668"><a href="#send_file-668"><span class="linenos">668</span></a>        <span class="n">signals</span><span class="p">,</span> <span class="n">signal_headers</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="n">highlevel</span><span class="o">.</span><span class="n">read_edf</span><span class="p">(</span><span class="n">edf_file</span><span class="p">,</span> <span class="n">ch_nrs</span><span class="p">,</span> <span class="n">ch_names</span><span class="p">)</span>
</span><span id="send_file-669"><a href="#send_file-669"><span class="linenos">669</span></a>
</span><span id="send_file-670"><a href="#send_file-670"><span class="linenos">670</span></a>        <span class="n">max_time</span> <span class="o">=</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">signal_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;sample_frequency&#39;</span><span class="p">]</span>
</span><span id="send_file-671"><a href="#send_file-671"><span class="linenos">671</span></a>        <span class="n">timestamps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">timestamp</span><span class="p">(),</span> <span class="n">max_time</span><span class="p">,</span> <span class="n">signals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="send_file-672"><a href="#send_file-672"><span class="linenos">672</span></a>
</span><span id="send_file-673"><a href="#send_file-673"><span class="linenos">673</span></a>        <span class="n">session_metadata</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="send_file-674"><a href="#send_file-674"><span class="linenos">674</span></a>          <span class="s2">&quot;user_id&quot;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="c1"># add user to the session for reference</span>
</span><span id="send_file-675"><a href="#send_file-675"><span class="linenos">675</span></a>          <span class="s2">&quot;session_date&quot;</span><span class="p">:</span> <span class="n">header</span><span class="p">[</span><span class="s1">&#39;startdate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m/</span><span class="si">%d</span><span class="s2">/%Y, %H:%M:%S&quot;</span><span class="p">)</span>
</span><span id="send_file-676"><a href="#send_file-676"><span class="linenos">676</span></a>        <span class="p">}</span>
</span><span id="send_file-677"><a href="#send_file-677"><span class="linenos">677</span></a>        <span class="k">if</span> <span class="n">validate_metadata</span><span class="p">(</span><span class="n">session_metadata</span><span class="p">,</span> <span class="s2">&quot;sessionSchema&quot;</span><span class="p">):</span>
</span><span id="send_file-678"><a href="#send_file-678"><span class="linenos">678</span></a>            <span class="n">session_id</span> <span class="o">=</span> <span class="n">set_session</span><span class="p">(</span><span class="n">metadata</span><span class="o">=</span><span class="p">{</span><span class="o">**</span><span class="n">session_metadata</span><span class="p">})</span>
</span><span id="send_file-679"><a href="#send_file-679"><span class="linenos">679</span></a>            <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;session_id&#39;</span><span class="p">:</span><span class="n">session_id</span><span class="p">,</span> <span class="o">**</span><span class="n">session_metadata</span><span class="p">,</span> <span class="o">**</span><span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">header</span><span class="p">),</span> <span class="o">**</span><span class="n">convert_datetime_in_dict</span><span class="p">(</span><span class="n">signal_headers</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
</span><span id="send_file-680"><a href="#send_file-680"><span class="linenos">680</span></a>
</span><span id="send_file-681"><a href="#send_file-681"><span class="linenos">681</span></a>            <span class="n">chunks</span> <span class="o">=</span> <span class="p">((</span><span class="n">signals</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">signals</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span><span class="o">//</span><span class="mi">300000</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="send_file-682"><a href="#send_file-682"><span class="linenos">682</span></a>            <span class="n">timestamps_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">timestamps</span><span class="p">,</span> <span class="n">chunks</span><span class="p">)</span>
</span><span id="send_file-683"><a href="#send_file-683"><span class="linenos">683</span></a>            <span class="n">signals_chunks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">signals</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="send_file-684"><a href="#send_file-684"><span class="linenos">684</span></a>            <span class="n">json_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">signals_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
</span><span id="send_file-685"><a href="#send_file-685"><span class="linenos">685</span></a>            <span class="n">size_in_bytes</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">getsizeof</span><span class="p">(</span><span class="n">json_data</span><span class="p">)</span>
</span><span id="send_file-686"><a href="#send_file-686"><span class="linenos">686</span></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2"> total bytes will be sent into </span><span class="si">%d</span><span class="s2"> chunks of </span><span class="si">%d</span><span class="s2"> bytes&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">signals</span><span class="o">.</span><span class="n">size</span> <span class="o">*</span> <span class="n">signals</span><span class="o">.</span><span class="n">itemsize</span><span class="p">,</span> <span class="n">chunks</span><span class="p">,</span> <span class="n">size_in_bytes</span><span class="p">))</span>
</span><span id="send_file-687"><a href="#send_file-687"><span class="linenos">687</span></a>
</span><span id="send_file-688"><a href="#send_file-688"><span class="linenos">688</span></a>            <span class="k">for</span> <span class="n">timestamps_chunk</span><span class="p">,</span><span class="n">signals_chunk</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">timestamps_chunks</span><span class="p">,</span> <span class="n">signals_chunks</span><span class="p">):</span>
</span><span id="send_file-689"><a href="#send_file-689"><span class="linenos">689</span></a>                <span class="n">upload_data</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps_chunk</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="n">signals_chunk</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="p">[],</span> <span class="p">[])</span>
</span><span id="send_file-690"><a href="#send_file-690"><span class="linenos">690</span></a>
</span><span id="send_file-691"><a href="#send_file-691"><span class="linenos">691</span></a>            <span class="k">return</span> <span class="n">session_id</span>
</span><span id="send_file-692"><a href="#send_file-692"><span class="linenos">692</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="send_file-693"><a href="#send_file-693"><span class="linenos">693</span></a>            <span class="k">return</span> <span class="kc">False</span>
</span><span id="send_file-694"><a href="#send_file-694"><span class="linenos">694</span></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="send_file-695"><a href="#send_file-695"><span class="linenos">695</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A general error occurred:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="send_file-696"><a href="#send_file-696"><span class="linenos">696</span></a>        <span class="k">return</span> <span class="kc">False</span>    
</span></pre></div>


            <div class="docstring"><p>Uploads EEG data from a file to the server along with associated metadata.</p>

<p>This function compiles EEG data from an <a href="https://www.edfplus.info/downloads/index.html">EDF file</a> along with metadata into a single dictionary,
encrypts the data, and then uploads it via a POST request. Upon successful upload, the server returns a
unique identifier for the session which can then be used for future queries or operations.</p>

<p>Args: <br />
<strong>user_id</strong> (<em>str</em>): The unique identifier of the user for whom the data is being collected. <br />
<strong>metadata</strong> (<em>dict</em>): Information about the data such as subject details and session parameters. <br />
<strong>date</strong> (<em>str</em>): The date of the session, used for metadata purposes. <br />
<strong>edf_file</strong> (<em>str</em>): name of an EDF file. <br />
<strong>ch_nrs</strong> (<em>list of int</em>, optional): The indices of the channels to read. The default is None. <br />
<strong>ch_names</strong> (<em>list of str</em>, optional): The names of channels to read. The default is None.     </p>

<p>Returns: <br />
    <em>tuple</em>: A tuple containing the session ID of the uploaded data if successful, and None otherwise.</p>

<p>Example:</p>

<pre><code>session = send_file('user123', '2021-06-01', 'nameoffile.edf')
if session:
    print(f"Session successfully started with ID: {session}")
else:
    print("Failed to start session")
</code></pre>
</div>


                </section>
                <section id="set_pipe">
                            <input id="set_pipe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pipe</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">metadata</span>, </span><span class="param"><span class="n">pipeline</span>, </span><span class="param"><span class="n">params</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="set_pipe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#set_pipe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="set_pipe-702"><a href="#set_pipe-702"><span class="linenos">702</span></a><span class="k">def</span> <span class="nf">set_pipe</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="set_pipe-703"><a href="#set_pipe-703"><span class="linenos">703</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="set_pipe-704"><a href="#set_pipe-704"><span class="linenos">704</span></a><span class="sd">    Configures and initiates a data processing pipeline for a session on the server.</span>
</span><span id="set_pipe-705"><a href="#set_pipe-705"><span class="linenos">705</span></a>
</span><span id="set_pipe-706"><a href="#set_pipe-706"><span class="linenos">706</span></a><span class="sd">    This function sends metadata and processing parameters to a specified pipeline endpoint</span>
</span><span id="set_pipe-707"><a href="#set_pipe-707"><span class="linenos">707</span></a><span class="sd">    to create a data processing session. It encrypts the session data before sending to ensure</span>
</span><span id="set_pipe-708"><a href="#set_pipe-708"><span class="linenos">708</span></a><span class="sd">    security. The function checks the server response to confirm the session creation.</span>
</span><span id="set_pipe-709"><a href="#set_pipe-709"><span class="linenos">709</span></a>
</span><span id="set_pipe-710"><a href="#set_pipe-710"><span class="linenos">710</span></a><span class="sd">    Args:     </span>
</span><span id="set_pipe-711"><a href="#set_pipe-711"><span class="linenos">711</span></a><span class="sd">    **metadata** (*dict*): A dictionary containing metadata about the session, typically including</span>
</span><span id="set_pipe-712"><a href="#set_pipe-712"><span class="linenos">712</span></a><span class="sd">                     details such as user ID and session date.       </span>
</span><span id="set_pipe-713"><a href="#set_pipe-713"><span class="linenos">713</span></a><span class="sd">    **pipeline** (*str*): The identifier for the processing pipeline to be used.      </span>
</span><span id="set_pipe-714"><a href="#set_pipe-714"><span class="linenos">714</span></a><span class="sd">    **params** (*dict*): Parameters specific to the processing pipeline, detailing how data should</span>
</span><span id="set_pipe-715"><a href="#set_pipe-715"><span class="linenos">715</span></a><span class="sd">                   be processed.      </span>
</span><span id="set_pipe-716"><a href="#set_pipe-716"><span class="linenos">716</span></a>
</span><span id="set_pipe-717"><a href="#set_pipe-717"><span class="linenos">717</span></a><span class="sd">    Returns:       </span>
</span><span id="set_pipe-718"><a href="#set_pipe-718"><span class="linenos">718</span></a><span class="sd">        *str* or *None*: The session ID if the session is successfully created, or None if the operation fails.</span>
</span><span id="set_pipe-719"><a href="#set_pipe-719"><span class="linenos">719</span></a>
</span><span id="set_pipe-720"><a href="#set_pipe-720"><span class="linenos">720</span></a><span class="sd">    Raises:     </span>
</span><span id="set_pipe-721"><a href="#set_pipe-721"><span class="linenos">721</span></a><span class="sd">        **requests.exceptions.RequestException**: An error from the Requests library when an HTTP request fails.      </span>
</span><span id="set_pipe-722"><a href="#set_pipe-722"><span class="linenos">722</span></a><span class="sd">        **KeyError**: If necessary keys are missing in the environment variables.</span>
</span><span id="set_pipe-723"><a href="#set_pipe-723"><span class="linenos">723</span></a>
</span><span id="set_pipe-724"><a href="#set_pipe-724"><span class="linenos">724</span></a><span class="sd">    Example:</span>
</span><span id="set_pipe-725"><a href="#set_pipe-725"><span class="linenos">725</span></a><span class="sd">    ```</span>
</span><span id="set_pipe-726"><a href="#set_pipe-726"><span class="linenos">726</span></a><span class="sd">    session_metadata = {&quot;user_id&quot;: &quot;123&quot;, &quot;session_date&quot;: &quot;2024-06-03&quot;}</span>
</span><span id="set_pipe-727"><a href="#set_pipe-727"><span class="linenos">727</span></a><span class="sd">    processing_params = {&quot;filter_type&quot;: &quot;lowpass&quot;, &quot;cutoff_freq&quot;: 30}</span>
</span><span id="set_pipe-728"><a href="#set_pipe-728"><span class="linenos">728</span></a><span class="sd">    session_id = set_pipe(session_metadata, &#39;eeg_smoothing&#39;, processing_params)</span>
</span><span id="set_pipe-729"><a href="#set_pipe-729"><span class="linenos">729</span></a><span class="sd">    if session_id:</span>
</span><span id="set_pipe-730"><a href="#set_pipe-730"><span class="linenos">730</span></a><span class="sd">        print(f&quot;Pipeline session created with ID: {session_id}&quot;)</span>
</span><span id="set_pipe-731"><a href="#set_pipe-731"><span class="linenos">731</span></a><span class="sd">    else:</span>
</span><span id="set_pipe-732"><a href="#set_pipe-732"><span class="linenos">732</span></a><span class="sd">        print(&quot;Failed to create pipeline session&quot;)</span>
</span><span id="set_pipe-733"><a href="#set_pipe-733"><span class="linenos">733</span></a><span class="sd">    ```</span>
</span><span id="set_pipe-734"><a href="#set_pipe-734"><span class="linenos">734</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="set_pipe-735"><a href="#set_pipe-735"><span class="linenos">735</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/sessions/pipe/</span><span class="si">{</span><span class="n">pipeline</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="set_pipe-736"><a href="#set_pipe-736"><span class="linenos">736</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="set_pipe-737"><a href="#set_pipe-737"><span class="linenos">737</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="set_pipe-738"><a href="#set_pipe-738"><span class="linenos">738</span></a>        <span class="s2">&quot;processing_params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="set_pipe-739"><a href="#set_pipe-739"><span class="linenos">739</span></a>    <span class="p">}</span>
</span><span id="set_pipe-740"><a href="#set_pipe-740"><span class="linenos">740</span></a>    <span class="n">_session</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_session</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="set_pipe-741"><a href="#set_pipe-741"><span class="linenos">741</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="set_pipe-742"><a href="#set_pipe-742"><span class="linenos">742</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="set_pipe-743"><a href="#set_pipe-743"><span class="linenos">743</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="set_pipe-744"><a href="#set_pipe-744"><span class="linenos">744</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="set_pipe-745"><a href="#set_pipe-745"><span class="linenos">745</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_session</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="set_pipe-746"><a href="#set_pipe-746"><span class="linenos">746</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="set_pipe-747"><a href="#set_pipe-747"><span class="linenos">747</span></a>    <span class="p">)</span>
</span><span id="set_pipe-748"><a href="#set_pipe-748"><span class="linenos">748</span></a>
</span><span id="set_pipe-749"><a href="#set_pipe-749"><span class="linenos">749</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="set_pipe-750"><a href="#set_pipe-750"><span class="linenos">750</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session successfully created.&quot;</span><span class="p">)</span>
</span><span id="set_pipe-751"><a href="#set_pipe-751"><span class="linenos">751</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="set_pipe-752"><a href="#set_pipe-752"><span class="linenos">752</span></a>        <span class="n">session_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
</span><span id="set_pipe-753"><a href="#set_pipe-753"><span class="linenos">753</span></a>        <span class="c1"># print(session_id)</span>
</span><span id="set_pipe-754"><a href="#set_pipe-754"><span class="linenos">754</span></a>        <span class="k">return</span> <span class="n">session_id</span>
</span><span id="set_pipe-755"><a href="#set_pipe-755"><span class="linenos">755</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="set_pipe-756"><a href="#set_pipe-756"><span class="linenos">756</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Session failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="set_pipe-757"><a href="#set_pipe-757"><span class="linenos">757</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Configures and initiates a data processing pipeline for a session on the server.</p>

<p>This function sends metadata and processing parameters to a specified pipeline endpoint
to create a data processing session. It encrypts the session data before sending to ensure
security. The function checks the server response to confirm the session creation.</p>

<p>Args: <br />
<strong>metadata</strong> (<em>dict</em>): A dictionary containing metadata about the session, typically including
                 details such as user ID and session date. <br />
<strong>pipeline</strong> (<em>str</em>): The identifier for the processing pipeline to be used. <br />
<strong>params</strong> (<em>dict</em>): Parameters specific to the processing pipeline, detailing how data should
               be processed.      </p>

<p>Returns: <br />
    <em>str</em> or <em>None</em>: The session ID if the session is successfully created, or None if the operation fails.</p>

<p>Raises: <br />
    <strong>requests.exceptions.RequestException</strong>: An error from the Requests library when an HTTP request fails. <br />
    <strong>KeyError</strong>: If necessary keys are missing in the environment variables.</p>

<p>Example:</p>

<pre><code>session_metadata = {"user_id": "123", "session_date": "2024-06-03"}
processing_params = {"filter_type": "lowpass", "cutoff_freq": 30}
session_id = set_pipe(session_metadata, 'eeg_smoothing', processing_params)
if session_id:
    print(f"Pipeline session created with ID: {session_id}")
else:
    print("Failed to create pipeline session")
</code></pre>
</div>


                </section>
                <section id="upload_pipedata">
                            <input id="upload_pipedata-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">upload_pipedata</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">metadata</span>, </span><span class="param"><span class="n">timestamps</span>, </span><span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">ppg_red</span>, </span><span class="param"><span class="n">ppg_ir</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="upload_pipedata-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#upload_pipedata"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="upload_pipedata-761"><a href="#upload_pipedata-761"><span class="linenos">761</span></a><span class="k">def</span> <span class="nf">upload_pipedata</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">ppg_red</span><span class="p">,</span> <span class="n">ppg_ir</span><span class="p">):</span>
</span><span id="upload_pipedata-762"><a href="#upload_pipedata-762"><span class="linenos">762</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="upload_pipedata-763"><a href="#upload_pipedata-763"><span class="linenos">763</span></a><span class="sd">    Uploads processed data to a specific session on the server.</span>
</span><span id="upload_pipedata-764"><a href="#upload_pipedata-764"><span class="linenos">764</span></a>
</span><span id="upload_pipedata-765"><a href="#upload_pipedata-765"><span class="linenos">765</span></a><span class="sd">    This function is responsible for uploading various data streams associated with a session, including</span>
</span><span id="upload_pipedata-766"><a href="#upload_pipedata-766"><span class="linenos">766</span></a><span class="sd">    timestamps and physiological measurements such as PPG (Photoplethysmogram). The data is encrypted before</span>
</span><span id="upload_pipedata-767"><a href="#upload_pipedata-767"><span class="linenos">767</span></a><span class="sd">    sending to ensure confidentiality and integrity.</span>
</span><span id="upload_pipedata-768"><a href="#upload_pipedata-768"><span class="linenos">768</span></a>
</span><span id="upload_pipedata-769"><a href="#upload_pipedata-769"><span class="linenos">769</span></a><span class="sd">    Args:        </span>
</span><span id="upload_pipedata-770"><a href="#upload_pipedata-770"><span class="linenos">770</span></a><span class="sd">    **metadata** (*dict*): Contains session-related metadata including the session ID.      </span>
</span><span id="upload_pipedata-771"><a href="#upload_pipedata-771"><span class="linenos">771</span></a><span class="sd">    **timestamps** (*list*): A list of timestamps corresponding to each data point.      </span>
</span><span id="upload_pipedata-772"><a href="#upload_pipedata-772"><span class="linenos">772</span></a><span class="sd">    **data** (*list*): The main data collected, e.g., EEG readings.      </span>
</span><span id="upload_pipedata-773"><a href="#upload_pipedata-773"><span class="linenos">773</span></a><span class="sd">    **ppg_red** (*list*): Red channel data from a PPG sensor.    </span>
</span><span id="upload_pipedata-774"><a href="#upload_pipedata-774"><span class="linenos">774</span></a><span class="sd">    **ppg_ir** (*list*): Infrared channel data from a PPG sensor.     </span>
</span><span id="upload_pipedata-775"><a href="#upload_pipedata-775"><span class="linenos">775</span></a>
</span><span id="upload_pipedata-776"><a href="#upload_pipedata-776"><span class="linenos">776</span></a><span class="sd">    Returns:     </span>
</span><span id="upload_pipedata-777"><a href="#upload_pipedata-777"><span class="linenos">777</span></a><span class="sd">    *tuple*: A tuple containing the data ID if the upload is successful and the processed data, or None if the upload fails.</span>
</span><span id="upload_pipedata-778"><a href="#upload_pipedata-778"><span class="linenos">778</span></a>
</span><span id="upload_pipedata-779"><a href="#upload_pipedata-779"><span class="linenos">779</span></a><span class="sd">    Raises:     </span>
</span><span id="upload_pipedata-780"><a href="#upload_pipedata-780"><span class="linenos">780</span></a><span class="sd">    **requests.exceptions.RequestException: An error from the Requests library when an HTTP request fails.</span>
</span><span id="upload_pipedata-781"><a href="#upload_pipedata-781"><span class="linenos">781</span></a><span class="sd">    **KeyError**: If necessary keys are missing in the environment variables.</span>
</span><span id="upload_pipedata-782"><a href="#upload_pipedata-782"><span class="linenos">782</span></a>
</span><span id="upload_pipedata-783"><a href="#upload_pipedata-783"><span class="linenos">783</span></a><span class="sd">    Example:</span>
</span><span id="upload_pipedata-784"><a href="#upload_pipedata-784"><span class="linenos">784</span></a><span class="sd">    ```</span>
</span><span id="upload_pipedata-785"><a href="#upload_pipedata-785"><span class="linenos">785</span></a><span class="sd">    session_metadata = {&quot;session_id&quot;: &quot;12345&quot;}</span>
</span><span id="upload_pipedata-786"><a href="#upload_pipedata-786"><span class="linenos">786</span></a><span class="sd">    timestamps = [1597709165, 1597709166, ...]</span>
</span><span id="upload_pipedata-787"><a href="#upload_pipedata-787"><span class="linenos">787</span></a><span class="sd">    data = [0.1, 0.2, ...]</span>
</span><span id="upload_pipedata-788"><a href="#upload_pipedata-788"><span class="linenos">788</span></a><span class="sd">    ppg_red = [12, 15, ...]</span>
</span><span id="upload_pipedata-789"><a href="#upload_pipedata-789"><span class="linenos">789</span></a><span class="sd">    ppg_ir = [20, 22, ...]</span>
</span><span id="upload_pipedata-790"><a href="#upload_pipedata-790"><span class="linenos">790</span></a><span class="sd">    data_id, processed_data = upload_pipedata(session_metadata, timestamps, data, ppg_red, ppg_ir)</span>
</span><span id="upload_pipedata-791"><a href="#upload_pipedata-791"><span class="linenos">791</span></a><span class="sd">    if data_id:</span>
</span><span id="upload_pipedata-792"><a href="#upload_pipedata-792"><span class="linenos">792</span></a><span class="sd">        print(f&quot;Data uploaded successfully with ID: {data_id}&quot;)</span>
</span><span id="upload_pipedata-793"><a href="#upload_pipedata-793"><span class="linenos">793</span></a><span class="sd">    else:</span>
</span><span id="upload_pipedata-794"><a href="#upload_pipedata-794"><span class="linenos">794</span></a><span class="sd">        print(&quot;Failed to upload data&quot;)</span>
</span><span id="upload_pipedata-795"><a href="#upload_pipedata-795"><span class="linenos">795</span></a><span class="sd">    ```</span>
</span><span id="upload_pipedata-796"><a href="#upload_pipedata-796"><span class="linenos">796</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="upload_pipedata-797"><a href="#upload_pipedata-797"><span class="linenos">797</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/pipedata/</span><span class="si">{</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="c1"># the metadata contain session_id to consistently pass it with each upload</span>
</span><span id="upload_pipedata-798"><a href="#upload_pipedata-798"><span class="linenos">798</span></a>
</span><span id="upload_pipedata-799"><a href="#upload_pipedata-799"><span class="linenos">799</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="upload_pipedata-800"><a href="#upload_pipedata-800"><span class="linenos">800</span></a>        <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
</span><span id="upload_pipedata-801"><a href="#upload_pipedata-801"><span class="linenos">801</span></a>        <span class="s2">&quot;timestamps&quot;</span><span class="p">:</span> <span class="n">timestamps</span><span class="p">,</span>
</span><span id="upload_pipedata-802"><a href="#upload_pipedata-802"><span class="linenos">802</span></a>        <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span>
</span><span id="upload_pipedata-803"><a href="#upload_pipedata-803"><span class="linenos">803</span></a>        <span class="s2">&quot;ppg_red&quot;</span><span class="p">:</span> <span class="n">ppg_red</span><span class="p">,</span>
</span><span id="upload_pipedata-804"><a href="#upload_pipedata-804"><span class="linenos">804</span></a>        <span class="s2">&quot;ppg_ir&quot;</span><span class="p">:</span> <span class="n">ppg_ir</span>
</span><span id="upload_pipedata-805"><a href="#upload_pipedata-805"><span class="linenos">805</span></a>    <span class="p">}</span>
</span><span id="upload_pipedata-806"><a href="#upload_pipedata-806"><span class="linenos">806</span></a>    <span class="n">_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_data</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="upload_pipedata-807"><a href="#upload_pipedata-807"><span class="linenos">807</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="upload_pipedata-808"><a href="#upload_pipedata-808"><span class="linenos">808</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="upload_pipedata-809"><a href="#upload_pipedata-809"><span class="linenos">809</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="upload_pipedata-810"><a href="#upload_pipedata-810"><span class="linenos">810</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="upload_pipedata-811"><a href="#upload_pipedata-811"><span class="linenos">811</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_data</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="upload_pipedata-812"><a href="#upload_pipedata-812"><span class="linenos">812</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="upload_pipedata-813"><a href="#upload_pipedata-813"><span class="linenos">813</span></a>    <span class="p">)</span>
</span><span id="upload_pipedata-814"><a href="#upload_pipedata-814"><span class="linenos">814</span></a>
</span><span id="upload_pipedata-815"><a href="#upload_pipedata-815"><span class="linenos">815</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="upload_pipedata-816"><a href="#upload_pipedata-816"><span class="linenos">816</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">flush</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="upload_pipedata-817"><a href="#upload_pipedata-817"><span class="linenos">817</span></a>        <span class="c1"># Extract the unique identifier for the uploaded data</span>
</span><span id="upload_pipedata-818"><a href="#upload_pipedata-818"><span class="linenos">818</span></a>        <span class="n">data_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_id&#39;</span><span class="p">)</span>
</span><span id="upload_pipedata-819"><a href="#upload_pipedata-819"><span class="linenos">819</span></a>        <span class="c1"># Retrieve the processed data</span>
</span><span id="upload_pipedata-820"><a href="#upload_pipedata-820"><span class="linenos">820</span></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pipeData&#39;</span><span class="p">)</span>
</span><span id="upload_pipedata-821"><a href="#upload_pipedata-821"><span class="linenos">821</span></a>        <span class="k">return</span> <span class="n">data_id</span><span class="p">,</span> <span class="n">data</span>
</span><span id="upload_pipedata-822"><a href="#upload_pipedata-822"><span class="linenos">822</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="upload_pipedata-823"><a href="#upload_pipedata-823"><span class="linenos">823</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Upload failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="upload_pipedata-824"><a href="#upload_pipedata-824"><span class="linenos">824</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Uploads processed data to a specific session on the server.</p>

<p>This function is responsible for uploading various data streams associated with a session, including
timestamps and physiological measurements such as PPG (Photoplethysmogram). The data is encrypted before
sending to ensure confidentiality and integrity.</p>

<p>Args: <br />
<strong>metadata</strong> (<em>dict</em>): Contains session-related metadata including the session ID. <br />
<strong>timestamps</strong> (<em>list</em>): A list of timestamps corresponding to each data point. <br />
<strong>data</strong> (<em>list</em>): The main data collected, e.g., EEG readings. <br />
<strong>ppg_red</strong> (<em>list</em>): Red channel data from a PPG sensor. <br />
<strong>ppg_ir</strong> (<em>list</em>): Infrared channel data from a PPG sensor.     </p>

<p>Returns: <br />
<em>tuple</em>: A tuple containing the data ID if the upload is successful and the processed data, or None if the upload fails.</p>

<p>Raises: <br />
<strong>requests.exceptions.RequestException: An error from the Requests library when an HTTP request fails.
**KeyError</strong>: If necessary keys are missing in the environment variables.</p>

<p>Example:</p>

<pre><code>session_metadata = {"session_id": "12345"}
timestamps = [1597709165, 1597709166, ...]
data = [0.1, 0.2, ...]
ppg_red = [12, 15, ...]
ppg_ir = [20, 22, ...]
data_id, processed_data = upload_pipedata(session_metadata, timestamps, data, ppg_red, ppg_ir)
if data_id:
    print(f"Data uploaded successfully with ID: {data_id}")
else:
    print("Failed to upload data")
</code></pre>
</div>


                </section>
                <section id="acquire_send_pipe">
                            <input id="acquire_send_pipe-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">acquire_send_pipe</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">pipeline</span>,</span><span class="param">	<span class="n">params</span>,</span><span class="param">	<span class="n">user_id</span>,</span><span class="param">	<span class="n">date</span>,</span><span class="param">	<span class="n">board</span>,</span><span class="param">	<span class="n">stream_duration</span>,</span><span class="param">	<span class="n">buffer_duration</span>,</span><span class="param">	<span class="n">callback</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="acquire_send_pipe-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#acquire_send_pipe"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="acquire_send_pipe-828"><a href="#acquire_send_pipe-828"><span class="linenos">828</span></a><span class="k">def</span> <span class="nf">acquire_send_pipe</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="acquire_send_pipe-829"><a href="#acquire_send_pipe-829"><span class="linenos">829</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="acquire_send_pipe-830"><a href="#acquire_send_pipe-830"><span class="linenos">830</span></a><span class="sd">    Acquires data from a board, processes it according to a specified pipeline, and sends it to a server.</span>
</span><span id="acquire_send_pipe-831"><a href="#acquire_send_pipe-831"><span class="linenos">831</span></a><span class="sd">    This function handles setting up a session for data acquisition and processing, connects to a board, </span>
</span><span id="acquire_send_pipe-832"><a href="#acquire_send_pipe-832"><span class="linenos">832</span></a><span class="sd">    and manages the data flow from acquisition through processing to uploading. It uses an asynchronous loop</span>
</span><span id="acquire_send_pipe-833"><a href="#acquire_send_pipe-833"><span class="linenos">833</span></a><span class="sd">    to handle the operations efficiently, suitable for real-time data processing scenarios.</span>
</span><span id="acquire_send_pipe-834"><a href="#acquire_send_pipe-834"><span class="linenos">834</span></a>
</span><span id="acquire_send_pipe-835"><a href="#acquire_send_pipe-835"><span class="linenos">835</span></a><span class="sd">    Args:</span>
</span><span id="acquire_send_pipe-836"><a href="#acquire_send_pipe-836"><span class="linenos">836</span></a><span class="sd">    **pipeline** (*str*): Name of the processing pipeline to use.     </span>
</span><span id="acquire_send_pipe-837"><a href="#acquire_send_pipe-837"><span class="linenos">837</span></a><span class="sd">    **params** (*dict*): Parameters for the pipeline processing.      </span>
</span><span id="acquire_send_pipe-838"><a href="#acquire_send_pipe-838"><span class="linenos">838</span></a><span class="sd">    **user_id** (*str*): The user ID to which the session will be associated.      </span>
</span><span id="acquire_send_pipe-839"><a href="#acquire_send_pipe-839"><span class="linenos">839</span></a><span class="sd">    **date** (*str*): Date of the session for tracking purposes.      </span>
</span><span id="acquire_send_pipe-840"><a href="#acquire_send_pipe-840"><span class="linenos">840</span></a><span class="sd">    **board** (*int*): Identifier for the hardware board to use for data acquisition.      </span>
</span><span id="acquire_send_pipe-841"><a href="#acquire_send_pipe-841"><span class="linenos">841</span></a><span class="sd">    **stream_duration** (*int*): Duration in seconds to stream data from the board.     </span>
</span><span id="acquire_send_pipe-842"><a href="#acquire_send_pipe-842"><span class="linenos">842</span></a><span class="sd">    **buffer_duration** (*int*): Duration in seconds to buffer data before processing.      </span>
</span><span id="acquire_send_pipe-843"><a href="#acquire_send_pipe-843"><span class="linenos">843</span></a><span class="sd">    **callback** (*function*): Optional callback function to execute after data is sent.</span>
</span><span id="acquire_send_pipe-844"><a href="#acquire_send_pipe-844"><span class="linenos">844</span></a>
</span><span id="acquire_send_pipe-845"><a href="#acquire_send_pipe-845"><span class="linenos">845</span></a><span class="sd">    Returns:    </span>
</span><span id="acquire_send_pipe-846"><a href="#acquire_send_pipe-846"><span class="linenos">846</span></a><span class="sd">        *str* or *bool*: The session ID if successful, False otherwise.</span>
</span><span id="acquire_send_pipe-847"><a href="#acquire_send_pipe-847"><span class="linenos">847</span></a>
</span><span id="acquire_send_pipe-848"><a href="#acquire_send_pipe-848"><span class="linenos">848</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="acquire_send_pipe-849"><a href="#acquire_send_pipe-849"><span class="linenos">849</span></a>    <span class="n">session_id</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span> 
</span><span id="acquire_send_pipe-850"><a href="#acquire_send_pipe-850"><span class="linenos">850</span></a>        <span class="n">_acquire_send_pipe</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">board</span><span class="p">,</span> <span class="n">stream_duration</span><span class="p">,</span> <span class="n">buffer_duration</span><span class="p">,</span> <span class="n">callback</span><span class="p">)</span> 
</span><span id="acquire_send_pipe-851"><a href="#acquire_send_pipe-851"><span class="linenos">851</span></a>    <span class="p">)</span>
</span><span id="acquire_send_pipe-852"><a href="#acquire_send_pipe-852"><span class="linenos">852</span></a>    <span class="k">return</span> <span class="n">session_id</span>
</span></pre></div>


            <div class="docstring"><p>Acquires data from a board, processes it according to a specified pipeline, and sends it to a server.
This function handles setting up a session for data acquisition and processing, connects to a board, 
and manages the data flow from acquisition through processing to uploading. It uses an asynchronous loop
to handle the operations efficiently, suitable for real-time data processing scenarios.</p>

<p>Args:
<strong>pipeline</strong> (<em>str</em>): Name of the processing pipeline to use. <br />
<strong>params</strong> (<em>dict</em>): Parameters for the pipeline processing. <br />
<strong>user_id</strong> (<em>str</em>): The user ID to which the session will be associated. <br />
<strong>date</strong> (<em>str</em>): Date of the session for tracking purposes. <br />
<strong>board</strong> (<em>int</em>): Identifier for the hardware board to use for data acquisition. <br />
<strong>stream_duration</strong> (<em>int</em>): Duration in seconds to stream data from the board. <br />
<strong>buffer_duration</strong> (<em>int</em>): Duration in seconds to buffer data before processing. <br />
<strong>callback</strong> (<em>function</em>): Optional callback function to execute after data is sent.</p>

<p>Returns: <br />
    <em>str</em> or <em>bool</em>: The session ID if successful, False otherwise.</p>
</div>


                </section>
                <section id="train">
                            <input id="train-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">train</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">session_id</span>, </span><span class="param"><span class="n">params</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="train-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#train"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="train-883"><a href="#train-883"><span class="linenos">883</span></a><span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="n">session_id</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="train-884"><a href="#train-884"><span class="linenos">884</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="train-885"><a href="#train-885"><span class="linenos">885</span></a><span class="sd">    Sends a request to the server to train a machine learning algorithm on the data from a specified session.</span>
</span><span id="train-886"><a href="#train-886"><span class="linenos">886</span></a>
</span><span id="train-887"><a href="#train-887"><span class="linenos">887</span></a><span class="sd">    Args:     </span>
</span><span id="train-888"><a href="#train-888"><span class="linenos">888</span></a><span class="sd">    **session_id** (*str*): The unique identifier of the session containing the data to be used for training.       </span>
</span><span id="train-889"><a href="#train-889"><span class="linenos">889</span></a><span class="sd">    **params** (*dict*): The parameters for the training process.</span>
</span><span id="train-890"><a href="#train-890"><span class="linenos">890</span></a>
</span><span id="train-891"><a href="#train-891"><span class="linenos">891</span></a><span class="sd">    Returns:      </span>
</span><span id="train-892"><a href="#train-892"><span class="linenos">892</span></a><span class="sd">        *str* or *None*: The task ID if the request is successful, None otherwise.</span>
</span><span id="train-893"><a href="#train-893"><span class="linenos">893</span></a>
</span><span id="train-894"><a href="#train-894"><span class="linenos">894</span></a><span class="sd">    This function sends the training parameters and session ID to the server, which initiates the training process.</span>
</span><span id="train-895"><a href="#train-895"><span class="linenos">895</span></a><span class="sd">    The response includes a task ID that can be used for future interactions related to the training task.</span>
</span><span id="train-896"><a href="#train-896"><span class="linenos">896</span></a>
</span><span id="train-897"><a href="#train-897"><span class="linenos">897</span></a><span class="sd">    Example:</span>
</span><span id="train-898"><a href="#train-898"><span class="linenos">898</span></a><span class="sd">    ```</span>
</span><span id="train-899"><a href="#train-899"><span class="linenos">899</span></a><span class="sd">    train(&quot;session_12345&quot;, {&quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;})</span>
</span><span id="train-900"><a href="#train-900"><span class="linenos">900</span></a><span class="sd">    ```</span>
</span><span id="train-901"><a href="#train-901"><span class="linenos">901</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="train-902"><a href="#train-902"><span class="linenos">902</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/train/</span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="train-903"><a href="#train-903"><span class="linenos">903</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="train-904"><a href="#train-904"><span class="linenos">904</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="train-905"><a href="#train-905"><span class="linenos">905</span></a>    <span class="p">}</span>
</span><span id="train-906"><a href="#train-906"><span class="linenos">906</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="train-907"><a href="#train-907"><span class="linenos">907</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="train-908"><a href="#train-908"><span class="linenos">908</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="train-909"><a href="#train-909"><span class="linenos">909</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="train-910"><a href="#train-910"><span class="linenos">910</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="train-911"><a href="#train-911"><span class="linenos">911</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="train-912"><a href="#train-912"><span class="linenos">912</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="train-913"><a href="#train-913"><span class="linenos">913</span></a>    <span class="p">)</span>
</span><span id="train-914"><a href="#train-914"><span class="linenos">914</span></a>
</span><span id="train-915"><a href="#train-915"><span class="linenos">915</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="train-916"><a href="#train-916"><span class="linenos">916</span></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">)</span>
</span><span id="train-917"><a href="#train-917"><span class="linenos">917</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Published. For future interactions, use task_id:&quot;</span><span class="p">,</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="train-918"><a href="#train-918"><span class="linenos">918</span></a>        <span class="k">return</span> <span class="n">task_id</span>
</span><span id="train-919"><a href="#train-919"><span class="linenos">919</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="train-920"><a href="#train-920"><span class="linenos">920</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Publish failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="train-921"><a href="#train-921"><span class="linenos">921</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Sends a request to the server to train a machine learning algorithm on the data from a specified session.</p>

<p>Args: <br />
<strong>session_id</strong> (<em>str</em>): The unique identifier of the session containing the data to be used for training. <br />
<strong>params</strong> (<em>dict</em>): The parameters for the training process.</p>

<p>Returns: <br />
    <em>str</em> or <em>None</em>: The task ID if the request is successful, None otherwise.</p>

<p>This function sends the training parameters and session ID to the server, which initiates the training process.
The response includes a task ID that can be used for future interactions related to the training task.</p>

<p>Example:</p>

<pre><code>train("session_12345", {"param1": "value1", "param2": "value2"})
</code></pre>
</div>


                </section>
                <section id="infer">
                            <input id="infer-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">infer</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data_id</span>, </span><span class="param"><span class="n">params</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="infer-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#infer"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="infer-925"><a href="#infer-925"><span class="linenos">925</span></a><span class="k">def</span> <span class="nf">infer</span><span class="p">(</span><span class="n">data_id</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
</span><span id="infer-926"><a href="#infer-926"><span class="linenos">926</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="infer-927"><a href="#infer-927"><span class="linenos">927</span></a><span class="sd">    Sends a request to the server to perform machine learning inference based on a previously trained model, given the data ID.</span>
</span><span id="infer-928"><a href="#infer-928"><span class="linenos">928</span></a>
</span><span id="infer-929"><a href="#infer-929"><span class="linenos">929</span></a><span class="sd">    Args:     </span>
</span><span id="infer-930"><a href="#infer-930"><span class="linenos">930</span></a><span class="sd">    **data_id** (*str*): The unique identifier of the data to be used for inference.      </span>
</span><span id="infer-931"><a href="#infer-931"><span class="linenos">931</span></a><span class="sd">    **params** (*dict*): The parameters for the inference process.</span>
</span><span id="infer-932"><a href="#infer-932"><span class="linenos">932</span></a>
</span><span id="infer-933"><a href="#infer-933"><span class="linenos">933</span></a><span class="sd">    Returns:</span>
</span><span id="infer-934"><a href="#infer-934"><span class="linenos">934</span></a><span class="sd">    *str* or *None*: The task ID if the request is successful, None otherwise.</span>
</span><span id="infer-935"><a href="#infer-935"><span class="linenos">935</span></a>
</span><span id="infer-936"><a href="#infer-936"><span class="linenos">936</span></a><span class="sd">    This function sends the inference parameters and data ID to the server, which initiates the inference process.</span>
</span><span id="infer-937"><a href="#infer-937"><span class="linenos">937</span></a><span class="sd">    The response includes a task ID that can be used for future interactions related to the inference task.</span>
</span><span id="infer-938"><a href="#infer-938"><span class="linenos">938</span></a>
</span><span id="infer-939"><a href="#infer-939"><span class="linenos">939</span></a><span class="sd">    Example:</span>
</span><span id="infer-940"><a href="#infer-940"><span class="linenos">940</span></a><span class="sd">    ```</span>
</span><span id="infer-941"><a href="#infer-941"><span class="linenos">941</span></a><span class="sd">    infer(&quot;data_12345&quot;, {&quot;param1&quot;: &quot;value1&quot;, &quot;param2&quot;: &quot;value2&quot;})</span>
</span><span id="infer-942"><a href="#infer-942"><span class="linenos">942</span></a><span class="sd">    ```</span>
</span><span id="infer-943"><a href="#infer-943"><span class="linenos">943</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="infer-944"><a href="#infer-944"><span class="linenos">944</span></a>    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">BASE_URL</span><span class="si">}</span><span class="s2">/api/</span><span class="si">{</span><span class="n">VERSION</span><span class="si">}</span><span class="s2">/infer/</span><span class="si">{</span><span class="n">data_id</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="infer-945"><a href="#infer-945"><span class="linenos">945</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="infer-946"><a href="#infer-946"><span class="linenos">946</span></a>        <span class="s2">&quot;params&quot;</span><span class="p">:</span> <span class="n">params</span><span class="p">,</span>
</span><span id="infer-947"><a href="#infer-947"><span class="linenos">947</span></a>    <span class="p">}</span>
</span><span id="infer-948"><a href="#infer-948"><span class="linenos">948</span></a>    <span class="n">_params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">_params</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="infer-949"><a href="#infer-949"><span class="linenos">949</span></a>    <span class="c1"># response = requests.post(url, json=_params)</span>
</span><span id="infer-950"><a href="#infer-950"><span class="linenos">950</span></a>    <span class="n">aes_key_b64</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;AES_KEY&#39;</span><span class="p">)</span>
</span><span id="infer-951"><a href="#infer-951"><span class="linenos">951</span></a>    <span class="n">aes_key_bytes</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">aes_key_b64</span><span class="p">)</span>
</span><span id="infer-952"><a href="#infer-952"><span class="linenos">952</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="infer-953"><a href="#infer-953"><span class="linenos">953</span></a>        <span class="n">url</span><span class="p">,</span>
</span><span id="infer-954"><a href="#infer-954"><span class="linenos">954</span></a>        <span class="n">data</span><span class="o">=</span><span class="n">encrypt_message</span><span class="p">(</span><span class="n">_params</span><span class="p">,</span> <span class="n">aes_key_bytes</span><span class="p">),</span>
</span><span id="infer-955"><a href="#infer-955"><span class="linenos">955</span></a>        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Content-Type&#39;</span><span class="p">:</span> <span class="s1">&#39;application/octet-stream&#39;</span><span class="p">}</span>
</span><span id="infer-956"><a href="#infer-956"><span class="linenos">956</span></a>    <span class="p">)</span>
</span><span id="infer-957"><a href="#infer-957"><span class="linenos">957</span></a>    
</span><span id="infer-958"><a href="#infer-958"><span class="linenos">958</span></a>    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="infer-959"><a href="#infer-959"><span class="linenos">959</span></a>        <span class="n">task_id</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;task_id&#39;</span><span class="p">)</span>
</span><span id="infer-960"><a href="#infer-960"><span class="linenos">960</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Published. For future interactions, use task_id:&quot;</span><span class="p">,</span><span class="n">task_id</span><span class="p">)</span>
</span><span id="infer-961"><a href="#infer-961"><span class="linenos">961</span></a>        <span class="k">return</span> <span class="n">task_id</span>
</span><span id="infer-962"><a href="#infer-962"><span class="linenos">962</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="infer-963"><a href="#infer-963"><span class="linenos">963</span></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Publish failed:&quot;</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span><span id="infer-964"><a href="#infer-964"><span class="linenos">964</span></a>        <span class="k">return</span> <span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Sends a request to the server to perform machine learning inference based on a previously trained model, given the data ID.</p>

<p>Args: <br />
<strong>data_id</strong> (<em>str</em>): The unique identifier of the data to be used for inference. <br />
<strong>params</strong> (<em>dict</em>): The parameters for the inference process.</p>

<p>Returns:
<em>str</em> or <em>None</em>: The task ID if the request is successful, None otherwise.</p>

<p>This function sends the inference parameters and data ID to the server, which initiates the inference process.
The response includes a task ID that can be used for future interactions related to the inference task.</p>

<p>Example:</p>

<pre><code>infer("data_12345", {"param1": "value1", "param2": "value2"})
</code></pre>
</div>


                </section>
    </main>
</body>
</html>